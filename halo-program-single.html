<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaloMD Modernization Program - Organization Structure</title>
    <style>
:root {
    --primary-color: #4a5568;
    --secondary-color: #718096;
    --success-color: #48bb78;
    --warning-color: #ed8936;
    --danger-color: #f56565;
    --background: #fafafa;
    --surface: #ffffff;
    --surface-elevated: #ffffff;
    --text-primary: #2d3748;
    --text-secondary: #4a5568;
    --text-tertiary: #718096;
    --border: #e2e8f0;
    --border-light: #edf2f7;
    --halo-color: #2b6cb0;
    --halo-light: #f0f7ff;
    --halo-border: #90cdf4;
    --hakkoda-color: #6b46c1;
    --hakkoda-light: #f7f3ff;
    --hakkoda-border: #b794f4;
    --shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-lg: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-xl: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --radius: 6px;
    --radius-lg: 8px;
    --radius-xl: 12px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
    background: var(--background);
    color: var(--text-primary);
    line-height: 1.5;
    font-weight: 400;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.container {
    max-width: 100%;
    margin: 0;
    padding: 24px;
}

header {
    background: var(--surface);
    padding: 20px 32px;
    margin: -24px -24px 24px -24px;
    border-bottom: 1px solid var(--border);
    box-shadow: var(--shadow);
}

header h1 {
    font-size: 24px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 16px;
    letter-spacing: -0.01em;
}

.header-nav {
    display: flex;
    gap: 8px;
    border-bottom: 2px solid var(--border);
    padding-bottom: 0;
}

.tab-btn {
    background: none;
    border: none;
    padding: 12px 20px;
    font-size: 15px;
    font-weight: 500;
    color: var(--text-tertiary);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s ease;
    letter-spacing: -0.01em;
}

.tab-btn:hover {
    color: var(--text-primary);
}

.tab-btn.active {
    color: var(--text-primary);
    border-bottom-color: var(--primary-color);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.btn-primary, .btn-secondary {
    padding: 10px 20px;
    border: none;
    border-radius: 980px;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    letter-spacing: -0.01em;
    white-space: nowrap;
}

.btn-primary {
    background: var(--text-primary);
    color: white;
}

.btn-primary:hover {
    background: var(--text-secondary);
    transform: translateY(-1px);
}

.btn-secondary {
    background: var(--surface-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    background: var(--surface);
    border-color: var(--text-tertiary);
}

.chart-controls {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    padding: 16px;
    background: var(--background);
    border-radius: var(--radius);
    border: 1px solid var(--border-light);
    align-items: center;
    justify-content: space-between;
}

.timing-toggle {
    display: flex;
    gap: 4px;
    background: var(--surface);
    border-radius: 980px;
    padding: 4px;
    border: 1px solid var(--border);
}

.timing-btn {
    padding: 8px 20px;
    border: none;
    border-radius: 980px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    background: transparent;
    color: var(--text-tertiary);
}

.timing-btn:hover {
    color: var(--text-primary);
}

.timing-btn.active {
    background: var(--text-primary);
    color: white;
}

.phase-legend {
    display: flex;
    gap: 20px;
    font-size: 12px;
    margin-left: auto;
    align-items: center;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--text-tertiary);
}

.legend-box {
    width: 20px;
    height: 14px;
    border: 2px solid;
    border-radius: 3px;
}

.legend-box.next-indicator {
    border-color: #fb923c;
    box-shadow: 0 0 0 2px rgba(251, 146, 60, 0.3);
}

.legend-box.later-indicator {
    border-color: #a78bfa;
    box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.3);
}

.chart-actions {
    display: flex;
    gap: 8px;
}

.resource-info-bar {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px 20px;
    margin-bottom: 20px;
    display: flex;
    gap: 24px;
    align-items: center;
    font-size: 14px;
}

.resource-count {
    display: flex;
    align-items: center;
    gap: 8px;
}

.team-label {
    font-weight: 600;
    color: var(--text-secondary);
}

.team-count {
    background: var(--background);
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 500;
}

.halo-count {
    color: var(--halo-color);
    border: 1px solid var(--halo-border);
}

.hakkoda-count {
    color: var(--hakkoda-color);
    border: 1px solid var(--hakkoda-border);
}

.total-count {
    font-weight: 600;
    color: var(--text-primary);
    margin-left: auto;
}

.count-change {
    font-size: 12px;
    font-weight: 600;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 4px;
}

.change-positive {
    background: rgba(72, 187, 120, 0.15);
    color: var(--success-color);
}

.change-neutral {
    color: var(--text-tertiary);
}

.org-chart {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 32px;
    border: 1px solid var(--border-light);
    min-height: calc(100vh - 200px);
    overflow-x: auto;
    position: relative;
}

.org-node {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
}

.program-node {
    background: var(--text-primary);
    color: white;
    border-radius: var(--radius);
    padding: 20px 24px;
    margin: 0 auto 60px;
    max-width: 800px;
    box-shadow: var(--shadow-lg);
    position: relative;
}

.program-node::after {
    content: '';
    position: absolute;
    bottom: -60px;
    left: 50%;
    transform: translateX(-50%);
    width: 2px;
    height: 60px;
    background: var(--border);
}

.program-node h3 {
    font-size: 24px;
    margin-bottom: 16px;
}

.node-header h3 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.node-roles {
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-light);
}

.projects-container {
    display: flex;
    gap: 40px;
    justify-content: center;
    position: relative;
    padding-top: 20px;
}

.projects-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 2px;
    background: var(--border);
}

.project-container {
    flex: 1;
    max-width: 650px;
    min-width: 550px;
    background: var(--surface);
    border-radius: var(--radius);
    padding: 20px;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-lg);
    position: relative;
}

.project-container::before {
    content: '';
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 2px;
    height: 20px;
    background: var(--border);
}

.project-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--background);
    padding: 12px 16px;
    border-radius: var(--radius);
    margin-bottom: 20px;
    border: 1px solid var(--border-light);
}

.project-header h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

.expand-btn {
    background: var(--background);
    border: 1px solid var(--border);
    width: 24px;
    height: 24px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.expand-btn:hover {
    background: var(--surface);
    color: var(--text-primary);
}

.project-roles {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 24px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border-light);
}

.workstreams-container {
    display: block;
    position: relative;
    margin-top: 20px;
    padding-top: 20px;
}

.workstreams-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 20px;
    right: 20px;
    height: 1px;
    background: var(--border);
}

.workstream-node {
    background: var(--background);
    border-radius: var(--radius);
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
    position: relative;
}

.workstream-node::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--secondary-color);
    border-radius: var(--radius) 0 0 var(--radius);
}

.workstream-node h4 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 12px;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

.workstream-roles {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 10px;
}

.role-cards-container {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.role-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px 14px;
    cursor: pointer;
    transition: all 0.15s ease;
    min-width: 150px;
    max-width: 180px;
    position: relative;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
}

.role-card.next-phase {
    box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.3), 0 1px 2px rgba(0, 0, 0, 0.04);
    border-color: #fb923c;
}

.role-card.later-phase {
    box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.3), 0 1px 2px rgba(0, 0, 0, 0.04);
    border-color: #a78bfa;
}

.role-card.halo-role {
    background: var(--halo-light);
    border-color: var(--halo-border);
    border-width: 1.5px;
}

.role-card.hakkoda-role {
    background: var(--hakkoda-light);
    border-color: var(--hakkoda-border);
    border-width: 1.5px;
}

.role-card.halo-role.next-phase {
    box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.4), 0 1px 2px rgba(0, 0, 0, 0.04);
    border-color: var(--halo-color);
}

.role-card.hakkoda-role.next-phase {
    box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.4), 0 1px 2px rgba(0, 0, 0, 0.04);
    border-color: var(--hakkoda-color);
}

.role-card.halo-role.later-phase {
    box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.4), 0 1px 2px rgba(0, 0, 0, 0.04);
    border-color: var(--halo-color);
}

.role-card.hakkoda-role.later-phase {
    box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.4), 0 1px 2px rgba(0, 0, 0, 0.04);
    border-color: var(--hakkoda-color);
}

.role-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.role-card.halo-role:hover {
    border-color: var(--halo-color);
    background: white;
}

.role-card.hakkoda-role:hover {
    border-color: var(--hakkoda-color);
    background: white;
}

.role-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
    letter-spacing: -0.01em;
    line-height: 1.3;
}

.role-fte {
    font-size: 11px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 3px;
    display: inline-block;
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.fte-low {
    background: rgba(255, 149, 0, 0.15);
    color: var(--warning-color);
}

.fte-medium {
    background: rgba(52, 199, 89, 0.15);
    color: var(--success-color);
}

.fte-high {
    background: rgba(255, 59, 48, 0.15);
    color: var(--danger-color);
}

.role-assigned {
    font-size: 11px;
    color: var(--text-tertiary);
    font-weight: 400;
    opacity: 0.8;
}

.roles-container {
    display: flex;
    gap: 24px;
}

.roles-sidebar {
    width: 260px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: var(--radius-lg);
    padding: 24px;
    border: 1px solid var(--border-light);
    box-shadow: var(--shadow);
    height: fit-content;
    position: sticky;
    top: 20px;
}

.roles-sidebar h3 {
    font-size: 16px;
    margin-bottom: 16px;
    color: var(--text-primary);
}

.role-filter {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.filter-btn {
    background: none;
    border: none;
    padding: 10px 16px;
    text-align: left;
    font-size: 15px;
    font-weight: 500;
    color: var(--text-tertiary);
    cursor: pointer;
    border-radius: var(--radius);
    transition: all 0.2s ease;
}

.filter-btn:hover {
    background: var(--background);
    color: var(--text-primary);
}

.filter-btn.active {
    background: var(--primary-color);
    color: white;
}

.roles-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.role-definition {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: var(--radius-lg);
    padding: 28px;
    border: 1px solid var(--border-light);
    box-shadow: var(--shadow);
}

.role-definition h3 {
    font-size: 20px;
    margin-bottom: 12px;
    color: var(--text-primary);
}

.role-meta {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
}

.badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 980px;
    font-size: 12px;
    font-weight: 600;
    background: var(--background);
    color: var(--text-tertiary);
    letter-spacing: 0.02em;
}

.badge.category-executive {
    background: #fef3c7;
    color: #92400e;
}

.badge.category-leadership {
    background: #ddd6fe;
    color: #5b21b6;
}

.badge.category-technical {
    background: #dbeafe;
    color: #1e40af;
}

.badge.category-quality {
    background: #dcfce7;
    color: #166534;
}

.role-description {
    font-size: 14px;
    line-height: 1.6;
    color: var(--text-secondary);
    margin-bottom: 20px;
}

.role-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.detail-section h4 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.detail-section ul {
    list-style: none;
    padding: 0;
}

.detail-section li {
    font-size: 13px;
    color: var(--text-secondary);
    padding: 4px 0;
    padding-left: 20px;
    position: relative;
}

.detail-section li:before {
    content: "â€¢";
    position: absolute;
    left: 0;
    color: var(--primary-color);
}

.capacity-overview {
    background: var(--surface);
    border-radius: 12px;
    padding: 24px;
    box-shadow: var(--shadow);
}

.capacity-summary {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 24px;
    margin-bottom: 32px;
}

.summary-card {
    background: var(--surface);
    border: 1px solid var(--border-light);
    border-radius: var(--radius);
    padding: 24px;
    text-align: center;
    box-shadow: var(--shadow);
}

.summary-card h3 {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-tertiary);
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.fte-number {
    font-size: 32px;
    font-weight: 600;
    color: var(--text-primary);
}

.fte-number.gap {
    color: var(--danger-color);
}

.capacity-breakdown {
    margin-bottom: 32px;
}

.capacity-breakdown h3 {
    font-size: 18px;
    margin-bottom: 16px;
    color: var(--text-primary);
}

.capacity-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.capacity-card {
    background: var(--background);
    border-radius: 8px;
    padding: 20px;
    border: 1px solid var(--border);
}

.capacity-card h4 {
    font-size: 16px;
    margin-bottom: 12px;
    color: var(--text-primary);
}

.fte-display {
    font-size: 24px;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 12px;
}

.workstream-breakdown {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.8;
}

.capacity-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--surface);
}

.capacity-table th {
    background: var(--background);
    padding: 12px;
    text-align: left;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
}

.capacity-table td {
    padding: 12px;
    border-top: 1px solid var(--border);
    font-size: 14px;
}

.capacity-table .filled {
    color: var(--success-color);
}

.capacity-table .gap {
    color: var(--danger-color);
}

.capacity-table .over {
    color: var(--warning-color);
}

.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
}

.status-badge.filled {
    background: #dcfce7;
    color: #166534;
}

.status-badge.gap {
    background: #fee2e2;
    color: #991b1b;
}

.status-badge.over {
    background: #fed7aa;
    color: #9a3412;
}

.raci-container {
    background: var(--surface);
    border-radius: 12px;
    padding: 24px;
    box-shadow: var(--shadow);
}

.raci-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.raci-controls select {
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 14px;
    color: var(--text-primary);
    background: var(--surface);
}

.raci-matrix {
    overflow-x: auto;
}

.raci-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.raci-table th {
    background: var(--background);
    padding: 12px 8px;
    text-align: left;
    font-weight: 600;
    color: var(--text-secondary);
    border: 1px solid var(--border);
}

.raci-table th.rotate {
    writing-mode: vertical-rl;
    text-orientation: mixed;
    height: 150px;
    width: 40px;
    text-align: center;
}

.raci-table td {
    padding: 8px;
    border: 1px solid var(--border);
}

.raci-select {
    width: 100%;
    padding: 4px;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-size: 12px;
    text-align: center;
    background: var(--surface);
}

.raci-select:focus {
    outline: none;
    border-color: var(--primary-color);
}

.roster-container {
    background: var(--surface);
    border-radius: 12px;
    padding: 24px;
    box-shadow: var(--shadow);
}

.roster-controls {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
}

.empty-roster {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
}

.empty-roster p {
    margin-bottom: 8px;
}

.roster-table {
    width: 100%;
    border-collapse: collapse;
}

.roster-table th {
    background: var(--background);
    padding: 12px;
    text-align: left;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
}

.roster-table td {
    padding: 12px;
    border-top: 1px solid var(--border);
    font-size: 14px;
}

.roster-table button {
    padding: 6px 12px;
    margin-right: 4px;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.roster-table button:first-child {
    background: var(--primary-color);
    color: white;
}

.roster-table button:last-child {
    background: var(--danger-color);
    color: white;
}

.roster-table button:hover {
    opacity: 0.8;
    transform: translateY(-1px);
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

.modal-content {
    position: relative;
    background: var(--surface);
    margin: 50px auto;
    padding: 32px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.modal-content .close {
    position: absolute;
    top: 16px;
    right: 20px;
    font-size: 28px;
    font-weight: 300;
    color: var(--text-secondary);
    cursor: pointer;
    transition: color 0.3s ease;
}

.modal-content .close:hover {
    color: var(--text-primary);
}

.modal-content h2 {
    margin-bottom: 20px;
    font-size: 24px;
    color: var(--text-primary);
}

.role-detail-full {
    margin-top: 20px;
}

.detail-meta {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
}

.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    margin-top: 24px;
}

.detail-column h3 {
    font-size: 16px;
    margin-bottom: 12px;
    color: var(--text-primary);
}

.detail-column ul {
    list-style: none;
    padding: 0;
}

.detail-column li {
    font-size: 14px;
    color: var(--text-secondary);
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 14px;
    color: var(--text-primary);
    background: var(--surface);
    transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary-color);
}

.form-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 24px;
}

@media (max-width: 1200px) {
    .container {
        padding: 16px;
    }
    .projects-container {
        flex-direction: column;
    }
    .project-container {
        min-width: 100%;
    }
}

@media (max-width: 768px) {
    .header-nav {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    .tab-btn {
        white-space: nowrap;
    }
    .roles-container {
        flex-direction: column;
    }
    .roles-sidebar {
        width: 100%;
        position: static;
    }
    .capacity-summary {
        grid-template-columns: 1fr;
    }
    .detail-grid {
        grid-template-columns: 1fr;
    }
    .modal-content {
        margin: 20px;
        width: calc(100% - 40px);
    }
}

@media print {
    body {
        background: white;
    }
    .header-nav,
    .chart-controls,
    .roster-controls,
    .raci-controls,
    button {
        display: none;
    }
    .container {
        max-width: 100%;
    }
    .modal {
        display: none !important;
    }
}

/* Configuration Page Styles */
.config-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 24px;
}

.config-section {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: var(--shadow);
}

.config-section h2 {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 20px;
}

.phase-config {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.phase-item {
    background: var(--background);
    border-radius: var(--radius);
    padding: 16px;
    border: 1px solid var(--border);
}

.phase-item h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
}

.phase-item h3::before {
    content: '';
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 8px;
}

.phase-item:nth-child(1) h3::before {
    background: #48bb78;
}

.phase-item:nth-child(2) h3::before {
    background: #fb923c;
}

.phase-item:nth-child(3) h3::before {
    background: #a78bfa;
}

.date-inputs {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.date-inputs label {
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 14px;
    color: var(--text-secondary);
}

.date-inputs input[type="date"] {
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    background: var(--surface);
    color: var(--text-primary);
}

.date-inputs input[type="date"]:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.1);
}

.role-filters {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
}

.role-filters input[type="text"] {
    flex: 1;
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    background: var(--surface);
}

.role-filters select {
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    background: var(--surface);
    color: var(--text-primary);
    cursor: pointer;
}

.role-timing-grid {
    background: var(--background);
    border-radius: var(--radius);
    padding: 16px;
    max-height: 600px;
    overflow-y: auto;
    margin-bottom: 20px;
}

.role-timing-item {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 16px;
    align-items: center;
    padding: 12px;
    background: var(--surface);
    border-radius: var(--radius);
    margin-bottom: 8px;
    border: 1px solid var(--border);
    transition: all 0.2s ease;
}

.role-timing-item:hover {
    box-shadow: var(--shadow);
}

.role-timing-item.hidden {
    display: none;
}

.role-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.role-title {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 15px;
}

.role-category {
    font-size: 13px;
    color: var(--text-tertiary);
    text-transform: capitalize;
}

.timing-selector {
    display: flex;
    gap: 8px;
}

.timing-radio {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 14px;
    cursor: pointer;
}

.timing-radio input[type="radio"] {
    cursor: pointer;
}

.timing-radio label {
    cursor: pointer;
    color: var(--text-secondary);
}

.timing-radio input[type="radio"]:checked + label {
    color: var(--text-primary);
    font-weight: 500;
}

.role-start-date {
    display: flex;
    align-items: center;
    gap: 8px;
}

.role-start-date label {
    font-size: 13px;
    color: var(--text-tertiary);
}

.role-start-date input[type="date"] {
    padding: 6px 10px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 13px;
    background: var(--surface);
    color: var(--text-primary);
}

.save-btn {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 10px 24px;
    border-radius: var(--radius);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.save-btn:hover {
    background: #3d4753;
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
}

.save-btn:active {
    transform: translateY(0);
}

/* Definitions Tab Styles */
.definitions-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 24px;
}

.definitions-nav {
    display: flex;
    gap: 8px;
    margin-bottom: 24px;
    border-bottom: 2px solid var(--border);
    padding-bottom: 0;
}

.def-type-btn {
    background: none;
    border: none;
    padding: 12px 24px;
    font-size: 15px;
    font-weight: 500;
    color: var(--text-tertiary);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s ease;
}

.def-type-btn:hover {
    color: var(--text-primary);
}

.def-type-btn.active {
    color: var(--text-primary);
    border-bottom-color: var(--primary-color);
}

.workstreams-grid {
    display: grid;
    gap: 24px;
}

.workstream-card {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 24px;
    box-shadow: var(--shadow);
    transition: all 0.2s ease;
}

.workstream-card:hover {
    box-shadow: var(--shadow-lg);
}

.workstream-header {
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border);
}

.workstream-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.project-badge {
    font-size: 12px;
    padding: 4px 8px;
    background: var(--background);
    color: var(--text-secondary);
    border-radius: var(--radius);
    font-weight: 500;
}

.mission-statement {
    font-size: 15px;
    color: var(--text-secondary);
    font-style: italic;
    line-height: 1.5;
    margin-top: 8px;
    padding: 12px;
    background: var(--background);
    border-left: 3px solid var(--primary-color);
    border-radius: var(--radius);
}

.workstream-content {
    display: grid;
    gap: 20px;
}

.workstream-section {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.section-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}

.section-content {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
}

.goals-list, .deliverables-list {
    list-style: none;
    padding: 0;
}

.goals-list li, .deliverables-list li {
    position: relative;
    padding-left: 24px;
    margin-bottom: 8px;
    font-size: 14px;
    color: var(--text-secondary);
}

.goals-list li::before {
    content: 'âœ“';
    position: absolute;
    left: 0;
    color: var(--success-color);
    font-weight: bold;
}

.deliverables-list li::before {
    content: 'â–¸';
    position: absolute;
    left: 4px;
    color: var(--primary-color);
    font-weight: bold;
}

.phase-deliverables {
    display: grid;
    gap: 12px;
}

.phase-section {
    padding: 12px;
    background: var(--background);
    border-radius: var(--radius);
    border: 1px solid var(--border);
}

.phase-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.phase-label::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.phase-section.now .phase-label::before {
    background: #48bb78;
}

.phase-section.next .phase-label::before {
    background: #fb923c;
}

.phase-section.later .phase-label::before {
    background: #a78bfa;
}

/* Role Management Styles */
.role-management-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.add-role-btn {
    background: var(--success-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: var(--radius);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.add-role-btn:hover {
    background: #38a169;
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
}

.edit-role-btn {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: var(--radius);
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.edit-role-btn:hover {
    background: #3d4753;
}

/* Large Modal Styles */
.large-modal {
    max-width: 800px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.form-group.full-width {
    grid-column: 1 / -1;
}

.form-group label {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
}

.form-group input[type="text"],
.form-group input[type="number"],
.form-group input[type="date"],
.form-group select,
.form-group textarea {
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    background: var(--surface);
    color: var(--text-primary);
}

.form-group textarea {
    resize: vertical;
    font-family: inherit;
}

.responsibilities-list,
.metrics-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 12px;
}

.responsibility-item,
.metric-item {
    display: flex;
    gap: 8px;
    align-items: center;
}

.responsibility-item input,
.metric-item input {
    flex: 1;
}

.responsibility-item .hours-input {
    width: 100px;
}

.remove-item-btn {
    background: var(--danger-color);
    color: white;
    border: none;
    padding: 4px 8px;
    border-radius: var(--radius);
    font-size: 12px;
    cursor: pointer;
}

.remove-item-btn:hover {
    background: #e53e3e;
}

/* Organization Chart Info Box */
.org-chart-info-box {
    background: linear-gradient(135deg, #f0f7ff 0%, #f7f3ff 100%);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 20px;
    margin-bottom: 24px;
    box-shadow: var(--shadow);
}

.info-box-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.info-icon {
    color: var(--primary-color);
    flex-shrink: 0;
}

.info-box-header h3 {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.info-box-content {
    color: var(--text-secondary);
    font-size: 14px;
    line-height: 1.6;
}

.info-box-content p {
    margin-bottom: 12px;
}

.info-box-content p:last-child {
    margin-bottom: 0;
}

.info-box-content strong {
    color: var(--text-primary);
    font-weight: 600;
}

.info-steps {
    display: flex;
    gap: 20px;
    margin: 16px 0;
    padding: 16px;
    background: white;
    border-radius: var(--radius);
    border: 1px solid var(--border-light);
}

.step {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 10px;
}

.step-number {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    flex-shrink: 0;
}

.step-text {
    font-size: 13px;
    color: var(--text-primary);
    line-height: 1.4;
}

.info-note {
    padding: 12px;
    background: white;
    border-left: 3px solid var(--primary-color);
    border-radius: var(--radius);
    margin-top: 16px;
    font-size: 14px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .info-steps {
        flex-direction: column;
        gap: 12px;
    }

    .step {
        align-items: flex-start;
    }
}

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HaloMD Modernization Program</h1>
            <div class="header-nav">
                <button class="tab-btn active" data-tab="org-chart">Organization Chart</button>
                <button class="tab-btn" data-tab="roles">Definitions</button>
                <button class="tab-btn" data-tab="capacity">Capacity Planning</button>
                <button class="tab-btn" data-tab="raci">RACI Matrix</button>
                <button class="tab-btn" data-tab="roster">Team Roster</button>
                <button class="tab-btn" data-tab="config">Configuration</button>
            </div>
        </header>

        <main>
            <div class="tab-content active" id="org-chart">
                <div class="org-chart-info-box">
                    <div class="info-box-header">
                        <svg class="info-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                            <path d="M10 14V9M10 6V6.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <h3>Understanding This Organization Chart</h3>
                    </div>
                    <div class="info-box-content">
                        <p><strong>This chart shows the functional roles NEEDED for project success, not current staffing.</strong></p>
                        <p>Each role represents a full-time position required to meet project demands in the selected phase. Many team members are currently covering multiple roles, leading to capacity constraints and bottlenecks.</p>
                        <div class="info-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <span class="step-text">Review all roles needed for success in each phase</span>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <span class="step-text">Validate that these roles are necessary</span>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <span class="step-text">Assign people to roles to identify gaps and overlaps</span>
                            </div>
                        </div>
                        <p class="info-note">ðŸ“Š Use the Capacity Planning tab to see the gap between required FTE and current staffing.</p>
                    </div>
                </div>
                <div class="chart-controls">
                    <div class="timing-toggle">
                        <button class="timing-btn active" data-timing="now" onclick="setTimingFilter('now')">Now</button>
                        <button class="timing-btn" data-timing="next" onclick="setTimingFilter('next')">Next</button>
                        <button class="timing-btn" data-timing="later" onclick="setTimingFilter('later')">Later</button>
                    </div>
                    <div class="chart-actions">
                        <button class="btn-secondary" onclick="expandAll()">Expand All</button>
                        <button class="btn-secondary" onclick="collapseAll()">Collapse All</button>
                        <button class="btn-primary" onclick="exportChart()">Export Chart</button>
                    </div>
                </div>
                <div class="resource-info-bar" id="resourceInfoBar">
                    <div class="resource-count">
                        <span class="team-label">Halo:</span>
                        <span class="team-count halo-count" id="haloCount">0</span>
                    </div>
                    <div class="resource-count">
                        <span class="team-label">Hakkoda:</span>
                        <span class="team-count hakkoda-count" id="hakkodaCount">0</span>
                    </div>
                    <div class="total-count" id="totalCount">Total: 0</div>
                    <div class="phase-legend" id="phaseLegend" style="display: none;">
                        <div class="legend-item">
                            <div class="legend-box next-indicator"></div>
                            <span>Added in Next</span>
                        </div>
                        <div class="legend-item" id="laterLegend" style="display: none;">
                            <div class="legend-box later-indicator"></div>
                            <span>Added in Later</span>
                        </div>
                    </div>
                </div>
                <div id="orgChart" class="org-chart"></div>
            </div>

            <div class="tab-content" id="roles">
                <div class="definitions-container">
                    <div class="definitions-nav">
                        <button class="def-type-btn active" data-type="workstreams" onclick="switchDefinitionType('workstreams')">Workstreams</button>
                        <button class="def-type-btn" data-type="roles" onclick="switchDefinitionType('roles')">Roles</button>
                    </div>

                    <div class="definition-content" id="workstreamDefinitions">
                        <div class="workstreams-grid" id="workstreamsGrid">
                            <!-- Workstream definitions will be rendered here -->
                        </div>
                    </div>

                    <div class="definition-content" id="roleDefinitions" style="display: none;">
                        <div class="roles-container">
                            <div class="roles-sidebar">
                                <h3>Role Categories</h3>
                                <div class="role-filter">
                                    <button class="filter-btn active" data-filter="all">All Roles</button>
                                    <button class="filter-btn" data-filter="executive">Executive</button>
                                    <button class="filter-btn" data-filter="leadership">Leadership</button>
                                    <button class="filter-btn" data-filter="technical">Technical</button>
                                    <button class="filter-btn" data-filter="quality">Quality</button>
                                </div>
                            </div>
                            <div class="roles-content" id="rolesContent"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="capacity">
                <div class="capacity-overview">
                    <div class="capacity-summary">
                        <div class="summary-card">
                            <h3>Projected FTE<br><span style="font-size: 11px; font-weight: 400; color: #718096;">(Actual Needed)</span></h3>
                            <div class="fte-number" id="projectedFTE">0</div>
                        </div>
                        <div class="summary-card">
                            <h3>Planned FTE<br><span style="font-size: 11px; font-weight: 400; color: #718096;">(Allocated)</span></h3>
                            <div class="fte-number" id="totalFTE">0</div>
                        </div>
                        <div class="summary-card">
                            <h3>Current FTE<br><span style="font-size: 11px; font-weight: 400; color: #718096;">(Filled)</span></h3>
                            <div class="fte-number" id="currentFTE">0</div>
                        </div>
                        <div class="summary-card">
                            <h3>Gap<br><span style="font-size: 11px; font-weight: 400; color: #718096;">(Projected - Current)</span></h3>
                            <div class="fte-number gap" id="gapFTE">0</div>
                        </div>
                    </div>
                    <div class="capacity-details" id="capacityDetails"></div>
                </div>
            </div>

            <div class="tab-content" id="raci">
                <div class="raci-container">
                    <div class="raci-controls">
                        <select id="raciProject">
                            <option value="all">All Projects</option>
                            <option value="project1">Project 1: Snowflake Platform</option>
                            <option value="project2">Project 2: Arbit V2</option>
                        </select>
                        <button class="btn-primary" onclick="exportRACI()">Export RACI</button>
                    </div>
                    <div class="raci-matrix" id="raciMatrix"></div>
                </div>
            </div>

            <div class="tab-content" id="roster">
                <div class="roster-container">
                    <div class="roster-controls">
                        <button class="btn-primary" onclick="addTeamMember()">Add Team Member</button>
                        <button class="btn-secondary" onclick="importRoster()">Import Roster</button>
                        <button class="btn-secondary" onclick="exportRoster()">Export Roster</button>
                    </div>
                    <div class="roster-grid" id="rosterGrid"></div>
                </div>
            </div>
        </main>

        <div class="modal" id="roleModal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <div id="roleModalContent"></div>
            </div>
        </div>

        <div class="modal" id="assignmentModal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Assign Team Member</h2>
                <form id="assignmentForm">
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" id="memberName" required>
                    </div>
                    <div class="form-group">
                        <label>Team:</label>
                        <select id="memberTeam" required>
                            <option value="">Select Team</option>
                            <option value="Halo">Halo</option>
                            <option value="Hakkoda">Hakkoda</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Role:</label>
                        <select id="memberRole" required></select>
                    </div>
                    <div class="form-group">
                        <label>Allocation (%):</label>
                        <input type="number" id="memberAllocation" min="0" max="100" value="100" required>
                    </div>
                    <div class="form-group">
                        <label>Start Date:</label>
                        <input type="date" id="memberStartDate" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Assign</button>
                        <button type="button" class="btn-secondary" onclick="closeAssignmentModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="tab-content" id="config">
            <div class="config-container">
                <div class="config-section">
                    <h2>Phase Configuration</h2>
                    <div class="phase-config">
                        <div class="phase-item">
                            <h3>Now Phase</h3>
                            <div class="date-inputs">
                                <label>
                                    Start Date:
                                    <input type="date" id="now-start" value="2024-01-01">
                                </label>
                                <label>
                                    End Date:
                                    <input type="date" id="now-end" value="2025-11-14">
                                </label>
                            </div>
                        </div>
                        <div class="phase-item">
                            <h3>Next Phase</h3>
                            <div class="date-inputs">
                                <label>
                                    Start Date:
                                    <input type="date" id="next-start" value="2025-11-15">
                                </label>
                                <label>
                                    End Date:
                                    <input type="date" id="next-end" value="2026-01-15">
                                </label>
                            </div>
                        </div>
                        <div class="phase-item">
                            <h3>Later Phase</h3>
                            <div class="date-inputs">
                                <label>
                                    Start Date:
                                    <input type="date" id="later-start" value="2026-01-16">
                                </label>
                                <label>
                                    End Date:
                                    <input type="date" id="later-end" value="2027-01-15">
                                </label>
                            </div>
                        </div>
                    </div>
                    <button class="save-btn" onclick="savePhaseDates()">Save Phase Dates</button>
                </div>

                <div class="config-section">
                    <h2>Role Management</h2>
                    <div class="role-management-header">
                        <div class="role-filters">
                            <input type="text" id="roleSearch" placeholder="Search roles..." onkeyup="filterConfigRoles()">
                            <select id="phaseFilter" onchange="filterConfigRoles()">
                                <option value="all">All Phases</option>
                                <option value="now">Now</option>
                                <option value="next">Next</option>
                                <option value="later">Later</option>
                            </select>
                        </div>
                        <button class="add-role-btn" onclick="openAddRoleModal()">+ Add New Role</button>
                    </div>
                    <div class="role-timing-grid" id="roleTimingGrid">
                        <!-- Roles will be populated here -->
                    </div>
                    <button class="save-btn" onclick="saveRoleTimings()">Save All Changes</button>
                </div>
            </div>
        </div>

        <!-- Role Edit Modal -->
        <div class="modal" id="roleEditModal">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h2 id="roleModalTitle">Edit Role</h2>
                    <span class="close" onclick="closeRoleModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="roleEditForm">
                        <input type="hidden" id="roleId" value="">
                        <input type="hidden" id="roleCategory" value="">

                        <div class="form-row">
                            <div class="form-group">
                                <label for="roleTitle">Role Title*</label>
                                <input type="text" id="roleTitle" required>
                            </div>
                            <div class="form-group">
                                <label for="roleLevel">Level*</label>
                                <select id="roleLevel" required>
                                    <option value="C-Suite">C-Suite</option>
                                    <option value="Director">Director</option>
                                    <option value="Principal">Principal</option>
                                    <option value="Senior">Senior</option>
                                    <option value="Mid">Mid</option>
                                    <option value="Junior">Junior</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="roleFTE">FTE Allocation*</label>
                                <input type="number" id="roleFTE" min="0.1" max="1" step="0.05" required>
                            </div>
                            <div class="form-group">
                                <label for="roleCategorySelect">Category*</label>
                                <select id="roleCategorySelect" required>
                                    <option value="executive">Executive</option>
                                    <option value="leadership">Leadership</option>
                                    <option value="technical">Technical</option>
                                    <option value="quality">Quality</option>
                                    <option value="support">Support</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="roleTiming">Phase*</label>
                                <select id="roleTiming" required>
                                    <option value="now">Now</option>
                                    <option value="next">Next</option>
                                    <option value="later">Later</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="roleStartDate">Start Date</label>
                                <input type="date" id="roleStartDate">
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="roleDescription">Description*</label>
                            <textarea id="roleDescription" rows="3" required></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label>Responsibilities</label>
                            <div id="responsibilitiesList" class="responsibilities-list">
                                <!-- Responsibilities will be added here -->
                            </div>
                            <button type="button" class="btn-secondary" onclick="addResponsibility()">+ Add Responsibility</button>
                        </div>

                        <div class="form-group full-width">
                            <label>Success Metrics</label>
                            <div id="metricsList" class="metrics-list">
                                <!-- Metrics will be added here -->
                            </div>
                            <button type="button" class="btn-secondary" onclick="addMetric()">+ Add Metric</button>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Save Role</button>
                            <button type="button" class="btn-secondary" onclick="closeRoleModal()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
// Program Organization Data Structure
const programData = {
    name: "HaloMD Modernization Program",
    description: "Enterprise-wide modernization initiative to transform healthcare data management and revenue recovery capabilities",
    roles: {
        executive: {
            "halo-executive-sponsor": {
                title: "HaloMD Executive Sponsor",
                category: "executive",
                level: "C-Suite",
                fte: 0.5,
                timing: "now",
                description: "Main business executive stakeholder representing Halo's strategic interests and business objectives",
                responsibilities: [
                    { task: "Define business strategy and objectives", hours: 4 },
                    { task: "Secure internal funding and resources", hours: 3 },
                    { task: "Align program with Halo business goals", hours: 4 },
                    { task: "Remove organizational barriers", hours: 3 },
                    { task: "Approve major business decisions", hours: 2 },
                    { task: "Represent Halo to external stakeholders", hours: 3 },
                    { task: "Drive adoption and change management", hours: 3 },
                    { task: "Review business ROI and value realization", hours: 3 }
                ],
                successMetrics: [
                    "Business value delivered",
                    "ROI achievement",
                    "Strategic alignment score",
                    "Stakeholder satisfaction",
                    "Adoption metrics"
                ],
                interfaces: ["Executive Sponsor", "Program Director", "Business Leaders"]
            },
            "executive-sponsor": {
                title: "Hakkoda Executive Sponsor",
                category: "executive",
                level: "C-Suite",
                fte: 0.5,
                timing: "now",
                description: "Senior executive accountable for program success and organizational alignment",
                responsibilities: [
                    { task: "Champion the program at the executive level", hours: 3 },
                    { task: "Secure funding and resources", hours: 2 },
                    { task: "Remove organizational barriers and escalations", hours: 3 },
                    { task: "Approve major strategic decisions and changes", hours: 2 },
                    { task: "Ensure alignment with corporate strategy", hours: 2 },
                    { task: "Report to board/investors on program progress", hours: 3 },
                    { task: "Build stakeholder confidence and buy-in", hours: 5 }
                ],
                successMetrics: [
                    "Program ROI achievement",
                    "Strategic objective alignment",
                    "Stakeholder satisfaction",
                    "Resource allocation effectiveness"
                ],
                interfaces: ["Board", "C-Suite", "Strategic Program Director", "Key Clients"]
            },
            "strategic-program-director": {
                title: "Strategic Program Director",
                category: "executive",
                level: "Director",
                fte: 1.0,
                timing: "next",
                description: "Senior leader responsible for overall program strategy, execution, and delivery",
                responsibilities: [
                    { task: "Define and maintain program strategy and roadmap", hours: 8 },
                    { task: "Manage program budget and financial performance", hours: 8 },
                    { task: "Lead cross-functional program governance", hours: 10 },
                    { task: "Oversee project portfolio and interdependencies", hours: 8 },
                    { task: "Drive stakeholder engagement and communication", hours: 10 },
                    { task: "Ensure program delivers business value", hours: 6 },
                    { task: "Manage program risks and issues", hours: 6 },
                    { task: "Report to executive sponsor and steering committee", hours: 4 },
                    { task: "Coordinate between technical and business teams", hours: 5 }
                ],
                successMetrics: [
                    "On-time, on-budget delivery",
                    "Business value realization",
                    "Stakeholder satisfaction scores",
                    "Risk mitigation effectiveness",
                    "Team performance and retention"
                ],
                interfaces: ["Executive Sponsor", "Project Architects", "Product Owners", "Client Leadership"]
            }
        },
        leadership: {
            "halo-enterprise-architect": {
                title: "HaloMD Enterprise Architect",
                category: "leadership",
                level: "Principal",
                fte: 1.0,
                timing: "now",
                description: "Enterprise architect ensuring overall solution alignment with HaloMD architecture standards",
                responsibilities: [
                    { task: "Define enterprise architecture standards", hours: 8 },
                    { task: "Review solution architectures", hours: 6 },
                    { task: "Ensure integration with existing systems", hours: 8 },
                    { task: "Lead architecture governance board", hours: 4 },
                    { task: "Evaluate technology decisions", hours: 5 },
                    { task: "Define security architecture patterns", hours: 4 },
                    { task: "Manage technical debt strategy", hours: 3 },
                    { task: "Mentor architecture team", hours: 3 },
                    { task: "Coordinate with vendor architects", hours: 3 }
                ],
                successMetrics: ["Architecture compliance", "Integration success rate", "Security posture", "Technical debt reduction"],
                interfaces: ["Executive Sponsors", "Platform Architects", "Security Team", "Program Director"]
            },
            
            "architect-snowflake": {
                title: "Data Platform Architect",
                category: "leadership",
                level: "Principal",
                fte: 1.0,
                timing: "now",
                description: "Technical leader responsible for Snowflake platform architecture and technical strategy",
                responsibilities: [
                    { task: "Design overall Snowflake platform architecture", hours: 4 },
                    { task: "Define data architecture standards and patterns", hours: 4 },
                    { task: "Lead technical decision making and trade-offs", hours: 4 },
                    { task: "Review and approve technical designs", hours: 4 },
                    { task: "Ensure scalability, security, and performance", hours: 8 },
                    { task: "Mentor technical teams", hours: 8 },
                    { task: "Evaluate and select technology components", hours: 2 },
                    { task: "Define integration patterns and APIs", hours: 2 }
                ],
                successMetrics: [
                    "Architecture quality and maintainability",
                    "Platform performance metrics",
                    "Technical debt reduction",
                    "Team technical capability growth",
                    "Security and compliance adherence"
                ],
                interfaces: ["Strategic Program Director", "Lead Engineers", "Product Owner", "Security Team"]
            },
            "architect-arbit": {
                title: "Software Application Architect",
                category: "leadership",
                level: "Principal",
                fte: 1.0,
                timing: "next",
                description: "Technical leader responsible for Arbit V2 application architecture and design",
                responsibilities: [
                    { task: "Design modern microservices architecture", hours: 10 },
                    { task: "Define API strategy and standards", hours: 6 },
                    { task: "Lead frontend and backend architecture decisions", hours: 8 },
                    { task: "Ensure application scalability and performance", hours: 6 },
                    { task: "Review code and design patterns", hours: 5 },
                    { task: "Define DevOps and CI/CD practices", hours: 5 },
                    { task: "Coordinate with Snowflake platform team", hours: 4 },
                    { task: "Guide AI/ML integration architecture", hours: 6 }
                ],
                successMetrics: [
                    "Application performance and reliability",
                    "Code quality metrics",
                    "Development velocity",
                    "Architecture documentation completeness",
                    "Technical innovation adoption"
                ],
                interfaces: ["Strategic Program Director", "AI Director", "Lead Engineers", "Product Owner"]
            },
            "product-owner-snowflake": {
                title: "Data Platform Product Owner",
                category: "leadership",
                level: "Senior Manager",
                fte: 1.0,
                timing: "now",
                description: "Business leader responsible for product vision, roadmap, and stakeholder value delivery",
                responsibilities: [
                    { task: "Define product vision and strategy", hours: 6 },
                    { task: "Manage and prioritize product backlog", hours: 10 },
                    { task: "Translate business needs to requirements", hours: 10 },
                    { task: "Accept deliverables and sign-off releases", hours: 3 },
                    { task: "Manage stakeholder expectations", hours: 6 },
                    { task: "Define success metrics and KPIs", hours: 3 },
                    { task: "Coordinate with client stakeholders", hours: 5 },
                    { task: "Ensure regulatory compliance requirements", hours: 3 }
                ],
                successMetrics: [
                    "Feature adoption rates",
                    "User satisfaction scores",
                    "Business value delivered",
                    "Backlog health and velocity",
                    "Stakeholder NPS scores"
                ],
                interfaces: ["Business Stakeholders", "Architect", "Project Manager", "Workstream Leads"]
            },
            "product-owner-arbit": {
                title: "Arbit V2 Product Owner",
                category: "leadership",
                level: "Senior Manager",
                fte: 1.0,
                timing: "now",
                description: "Business leader responsible for Arbit V2 product strategy and user experience",
                responsibilities: [
                    { task: "Define application product vision", hours: 4 },
                    { task: "Prioritize features based on user value", hours: 8 },
                    { task: "Manage user experience and design", hours: 6 },
                    { task: "Coordinate with UI/UX team", hours: 6 },
                    { task: "Define acceptance criteria", hours: 8 },
                    { task: "Conduct user research and feedback", hours: 4 },
                    { task: "Manage product launch and adoption", hours: 5 },
                    { task: "Define training and documentation needs", hours: 3 }
                ],
                successMetrics: [
                    "User adoption and engagement",
                    "Feature usage analytics",
                    "User satisfaction (CSAT/NPS)",
                    "Time to market",
                    "Revenue impact"
                ],
                interfaces: ["End Users", "UI/UX Team", "Architect", "Development Teams"]
            },
            "engagement-manager-snowflake": {
                title: "Data Platform Program Manager",
                category: "leadership",
                level: "Senior Manager",
                fte: 1.0,
                timing: "now",
                description: "Program leader responsible for coordinating 5 workstreams, PI planning, and overall Snowflake platform delivery",
                responsibilities: [
                    { task: "Coordinate and align 5 workstreams (Claims, Email, Revenue, Analytics, Pipeline)", hours: 12 },
                    { task: "Lead PI (Program Increment) planning sessions", hours: .25 },
                    { task: "Manage cross-workstream dependencies and integration", hours: 6 },
                    { task: "Oversee program timeline and milestone tracking", hours: 2 },
                    { task: "Track budget and resource allocation across workstreams", hours: 2 },
                    { task: "Facilitate program-level ceremonies and sync meetings", hours: 6 },
                    { task: "Report program status, metrics, and health to leadership", hours: 4 },
                    { task: "Manage program-level risks, impediments, and escalations", hours: 4 },
                    { task: "Ensure quality standards and delivery consistency", hours: 2 },
                    { task: "Drive continuous improvement across workstreams", hours: 2 }
                ],
                successMetrics: [
                    "On-time delivery across all workstreams",
                    "PI planning effectiveness (objectives met)",
                    "Cross-workstream dependency resolution time",
                    "Program budget variance < 5%",
                    "Team velocity and predictability",
                    "Stakeholder satisfaction score > 4.5/5"
                ],
                interfaces: ["Product Owner", "5 Workstream Leads", "Vendor Teams", "PMO", "Strategic Program Director"]
            },
            "engagement-manager-arbit": {
                title: "Arbit V2 Project Manager",
                category: "leadership",
                level: "Manager",
                fte: 1.0,
                timing: "next",
                description: "Delivery leader responsible for Arbit V2 project execution and team performance",
                responsibilities: [
                    { task: "Manage agile delivery process", hours: 8 },
                    { task: "Coordinate frontend and backend teams", hours: 8 },
                    { task: "Track sprint progress and burndown", hours: 4 },
                    { task: "Facilitate team ceremonies", hours: 8 },
                    { task: "Remove impediments", hours: 6 },
                    { task: "Manage team capacity and allocation", hours: 3 },
                    { task: "Report to program leadership", hours: 2 },
                    { task: "Coordinate with platform team", hours: 3 }
                ],
                successMetrics: [
                    "Sprint completion rate",
                    "Velocity trends",
                    "Defect rates",
                    "Team happiness index",
                    "Deployment frequency"
                ],
                interfaces: ["Product Owner", "Tech Leads", "DevOps Team", "QA Team"]
            },
            "ai-director": {
                title: "AI Director",
                category: "leadership",
                level: "Director",
                fte: 0.25,
                timing: "next",
                description: "Strategic leader driving AI/ML innovation and implementation across the program",
                responsibilities: [
                    { task: "Define AI/ML strategy and roadmap", hours: 2 },
                    { task: "Identify high-value AI use cases", hours: 2 },
                    { task: "Lead AI architecture and platform decisions", hours: 1 },
                    { task: "Manage AI team and capabilities", hours: 1 },
                    { task: "Ensure ethical AI practices", hours: 1 },
                    { task: "Drive AI POCs and experiments", hours: 1 },
                    { task: "Manage AI vendor relationships", hours: 1 },
                    { task: "Define AI governance and standards", hours: 0.5 },
                    { task: "Measure AI business impact", hours: 0.5 }
                ],
                successMetrics: [
                    "AI use case ROI",
                    "Model performance metrics",
                    "Innovation pipeline",
                    "AI adoption rate",
                    "Business value generated"
                ],
                interfaces: ["Strategic Program Director", "Architects", "Data Teams", "Business Leaders"]
            }
        },
        quality: {
            "hakkoda-qa-claims-engineer": {
                title: "Hakkoda QA Claims Engineer",
                category: "quality",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "QA specialist providing quality assurance and analysis for claims pipelines",
                responsibilities: [
                    { task: "QA EDI file loading processes", hours: 8 },
                    { task: "Analyze claim exclusion rule effectiveness", hours: 3 },
                    { task: "Validate data merge to Arbit accuracy", hours: 10 },
                    { task: "Monitor and analyze pipeline failures", hours: 4 },
                    { task: "Test dbt and dagster code changes", hours: 4 },
                    { task: "Perform claims data analysis", hours: 6 },
                    { task: "Create EDI test datasets", hours: 2 },
                    { task: "Support client success validation", hours: 2 }
                ],
                successMetrics: ["Test coverage", "Defect detection rate", "Claims accuracy"],
                interfaces: ["Claims Engineers", "Lead Engineers", "Product Owner"]
            },
            "hakkoda-qa-email-engineer": {
                title: "Hakkoda QA Email Engineer",
                category: "quality",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "QA specialist for email ingestion pipeline testing",
                responsibilities: [
                    { task: "QA GraphAPI email loading processes", hours: 5 },
                    { task: "Test email classification and tagging accuracy", hours: 8 },
                    { task: "Validate amount and attribute parsing", hours: 10 },
                    { task: "Analyze email to Arbit data quality", hours: 6 },
                    { task: "Monitor and analyze pipeline failures", hours: 3 },
                    { task: "Test dbt and dagster code changes", hours: 3 },
                    { task: "Analyze unstructured data patterns", hours: 5 },
                    { task: "Create email test datasets", hours: 2 }
                ],
                successMetrics: ["Test coverage", "Parsing accuracy", "Defect detection"],
                interfaces: ["Email Engineers", "Lead Engineers", "Product Owner"]
            },
            
        },
        technical: {
            "lead-engineer-halo": {
                title: "HaloMD Lead Engineer",
                category: "technical",
                level: "Lead",
                fte: 1.0,
                timing: "now",
                description: "Technical lead representing Halo's interests and ensuring platform alignment",
                responsibilities: [
                    { task: "Lead technical implementation from Halo side", hours: 10 },
                    { task: "Ensure alignment with Halo standards", hours: 6 },
                    { task: "Review and approve technical designs", hours: 6 },
                    { task: "Coordinate with Hakkoda team", hours: 6 },
                    { task: "Develop and test new platform features", hours: 6 },
                    { task: "Manage technical debt and refactoring", hours: 4 },
                    { task: "Lead code reviews and quality gates", hours: 5 },
                    { task: "Mentor junior engineers", hours: 3 },
                    { task: "Define coding standards", hours: 2 },
                    { task: "Troubleshoot complex issues", hours: 4 }
                ],
                workstreamSuccessMetrics: [
                    "On-time delivery of ingestion pipelines",
                    "Data quality scores > 99%",
                    "Processing latency < 5 minutes",
                    "Zero critical production incidents",
                    "100% automated deployment pipeline"
                ],
                successMetrics: [
                    "Code quality scores",
                    "Delivery velocity",
                    "Technical debt ratio",
                    "Team skill growth",
                    "Production stability"
                ],
                interfaces: ["Architect", "Hakkoda Lead", "Product Owner", "DevOps Team"]
            },
            "hakkoda-lead-claims-engineer": {
                title: "Hakkoda Lead Claims Engineer",
                category: "technical",
                level: "Lead",
                fte: 1.0,
                timing: "now",
                description: "Lead engineer managing claims data pipeline, V1-V2 migration, and platform modernization priorities",
                responsibilities: [
                    { task: "Maintain ADO board discipline - all work tracked, story pointed, 3 sprints planned", hours: 4 },
                    { task: "Lead V1 to V2 migration (EOY deadline) - customer schedule, runbook, weekly status", hours: 8 },
                    { task: "Complete Vituitry ingestion - EDI format, field mappings, exception handling", hours: 5 },
                    { task: "Implement RARC code exclusions with business justification and validation", hours: 3 },
                    { task: "Finalize VOB to production (2 weeks) - UAT, bug fixes, operations runbook", hours: 4 },
                    { task: "Execute NSB data backfill - ETL design, quality validation, audit trail", hours: 4 },
                    { task: "Automate workflows in Dagster - 2-3 workflows per sprint", hours: 3 },
                    { task: "Manage claims engineering team and vendor resources", hours: 2 }
                ],
                successMetrics: [
                    "V1-V2 migration on schedule (EOY)",
                    "Zero ghost work outside ADO",
                    "VOB in production within 2 weeks",
                    "Claims volume reporting shared with Stakeholders",
                    "Failures remediated < 4 hours"
                ],
                interfaces: ["Halo Lead Engineer", "Product Owner", "Claims Team", "Customer Success"]
            },
            "hakkoda-claims-engineer": {
                title: "Hakkoda Claims Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Engineer implementing EDI file loading and claims processing pipelines",
                responsibilities: [
                    { task: "Load EDI 835/837 files for customers", hours: 10 },
                    { task: "Implement claim exclusion rules logic", hours: 4 },
                    { task: "Build data merge and Arbit load processes", hours: 6 },
                    { task: "Develop and test new claims features", hours: 6 },
                    { task: "Optimize pipeline code performance", hours: 3 },
                    { task: "Develop dbt models for claims", hours: 4 },
                    { task: "Create dagster orchestration jobs", hours: 3 },
                    { task: "Handle claim data transformations", hours: 4 },
                    { task: "Support client success initiatives", hours: 2 }
                ],
                successMetrics: ["Claims processed per day", "Error rates", "Code quality"],
                interfaces: ["Lead Engineers", "QA Engineer", "Product Owner"]
            },

             "hakkoda-lead-email-engineer": {
                title: "Hakkoda Lead Email Engineer",
                category: "technical",
                level: "Lead",
                fte: 1.0,
                timing: "now",
                description: "Lead engineer focused on eliminating P1 email bugs and ensuring production quality",
                responsibilities: [
                    { task: "Maintain ADO board discipline - all work tracked, story pointed, 3 sprints planned", hours: 4 },
                    { task: "Break P1 bug pattern - root cause analysis, test coverage gaps, validation process", hours: 8 },
                    { task: "Achieve 30 days with zero P1 email bugs through proactive testing", hours: 6 },
                    { task: "Implement email hierarchy rules and testing", hours: 4 },
                    { task: "Clean up and audit exposure rules - remove redundancies", hours: 3 },
                    { task: "Deliver Mail Manager 2.0 export integration with monitoring", hours: 4 },
                    { task: "Strengthen pre-production validation and testing discipline", hours: 5 },
                    { task: "Lead GraphAPI email loading and parsing architecture", hours: 3 },
                    { task: "Manage email engineering team quality standards", hours: 3 }
                ],
                successMetrics: [
                    "Zero P1 bugs for 30+ days",
                    "100% test coverage for critical paths",
                    "All work visible in ADO",
                    "Pre-production validation gate effectiveness",
                    "Email processing accuracy > 99%"
                ],
                interfaces: ["Halo Lead Engineer", "Product Owner", "Email Team", "QA Team"]
            },
            
            "hakkoda-email-engineer": {
                title: "Hakkoda Email Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Engineer implementing GraphAPI email loading and parsing pipelines",
                responsibilities: [
                    { task: "Load emails from GraphAPI", hours: 8 },
                    { task: "Implement email classification and tagging", hours: 6 },
                    { task: "Parse emails for amounts and data attributes", hours: 10 },
                    { task: "Develop and test new email processing features", hours: 6 },
                    { task: "Build email to Arbit load processes", hours: 4 },
                    { task: "Optimize pipeline code performance", hours: 3 },
                    { task: "Develop dbt models for email data", hours: 3 },
                    { task: "Create dagster email orchestration", hours: 3 },
                    { task: "Extract insights from unstructured data", hours: 3 }
                ],
                successMetrics: [
                    "Email processing throughput",
                    "Data extraction accuracy",
                    "Pipeline reliability",
                    "Processing latency"
                ],
                interfaces: ["Lead Engineers", "QA Engineer", "Product Owner"]
            },
            
           
            "hakkoda-lead-revenue-engineer": {
                title: "Hakkoda Lead Revenue Recovery Engineer",
                category: "technical",
                level: "Lead",
                fte: 1.0,
                timing: "now",
                description: "Lead engineer building revenue recovery backlog and 835 payment tracking lineage",
                responsibilities: [
                    { task: "Maintain ADO board discipline - backlog built out 3 sprints with clear priorities", hours: 4 },
                    { task: "Implement 835 payment tracking lineage from receipt to customer payment", hours: 8 },
                    { task: "Build dashboard showing payment status per customer with visibility", hours: 5 },
                    { task: "Increase velocity on revenue recovery workstream deliverables", hours: 6 },
                    { task: "Lead award letter logic and integration", hours: 4 },
                    { task: "Manage revenue match reconciliation process", hours: 4 },
                    { task: "Integrate NSA dispute updates and tracking", hours: 3 },
                    { task: "Partner with finance teams on recovery strategies", hours: 3 },
                    { task: "Manage revenue recovery engineering team", hours: 3 }
                ],
                successMetrics: [
                    "Revenue recovery backlog 3 sprints deep",
                    "835 payment tracking in production",
                    "Customer payment visibility dashboard live",
                    "Increased velocity (story points per sprint)",
                    "Recovery rate improvements tracked"
                ],
                interfaces: ["Halo Lead Engineer", "Product Owner", "Revenue Team", "Finance Team"]
            },
            "hakkoda-revenue-engineer": {
                title: "Hakkoda Revenue Recovery Engineer - Data",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Engineer focused on data alignment and payment detection (Phases 1-2)",
                responsibilities: [
                    { task: "Build CLAIM_HEADER_ID/CLAIM_LINE_ID logic", hours: 6 },
                    { task: "Update database tables with NSA tracking fields", hours: 6 },
                    { task: "Map RARC codes (N875, N874, MA44) for classification", hours: 10 },
                    { task: "Build payment change detection system", hours: 8 },
                    { task: "Develop and test new data alignment features", hours: 6 },
                    { task: "Track Current_Paid_Amount changes from 835s", hours: 3 },
                    { task: "Create exception handling for edge cases", hours: 2 }
                ],
                successMetrics: ["Recovery success rate", "Processing speed", "Code quality"],
                interfaces: ["Lead Engineers", "QA Engineer", "Product Owner"]
            },
            "hakkoda-revenue-engineer-2": {
                title: "Hakkoda Revenue Recovery Engineer - Awards",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Engineer focused on award matching and reporting (Phases 3-5)",
                responsibilities: [
                    { task: "Parse award emails for dispute matching", hours: 8 },
                    { task: "Build smart matching for claim number variations", hours: 7 },
                    { task: "Implement invoice type framework", hours: 6 },
                    { task: "Develop and test award matching features", hours: 6 },
                    { task: "Build payer performance scorecards", hours: 5 },
                    { task: "Create recovery analytics reports", hours: 4 },
                    { task: "Develop customer billing summaries", hours: 3 },
                    { task: "Test and validate payment matching", hours: 2 },
                    { task: "Support production deployment and monitoring", hours: 2 }
                ],
                successMetrics: ["Award matching accuracy", "Report generation speed", "Customer satisfaction"],
                interfaces: ["Lead Engineers", "Analytics Team", "Product Owner"]
            },
            "hakkoda-lead-analytics-engineer": {
                title: "Hakkoda Lead Analytics Engineer",
                category: "technical",
                level: "Lead",
                fte: 1.0,
                timing: "now",
                description: "Lead engineer driving NSA analytics sign-off and enterprise data model completion",
                responsibilities: [
                    { task: "Maintain ADO board discipline - all analytics work tracked and prioritized", hours: 3 },
                    { task: "Drive NSA analytics sign-off (30-day plan with weekly milestones)", hours: 8 },
                    { task: "Document data model - schemas, ERD, data dictionary in Confluence", hours: 5 },
                    { task: "Map and catalogue NSA entities (ArbitrationCaseId, ClaimCPT, QPA, RARC)", hours: 4 },
                    { task: "Deliver reporting suite - case volumes, payments, disputes, customer dashboards", hours: 6 },
                    { task: "Build payor master database with integrations", hours: 4 },
                    { task: "Complete historical VOB integration and analysis", hours: 3 },
                    { task: "Partner with Halo leadership for business stakeholder sign-off", hours: 4 },
                    { task: "Manage analytics engineering team", hours: 3 }
                ],
                successMetrics: [
                    "NSA analytics sign-off achieved",
                    "100% data model documentation in Confluence",
                    "Basic reporting suite live and validated",
                    "Business stakeholder formal approval",
                    "Payor master database in production"
                ],
                interfaces: ["Halo Lead Engineer", "Product Owner", "Analytics Team", "Business Stakeholders"]
            },
            "halo-email-ba": {
                title: "HaloMD Business Analyst - Email",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Business analyst supporting email ingestion workstream with requirements and process analysis",
                responsibilities: [
                    { task: "Analyze email processing requirements", hours: 8 },
                    { task: "Document email workflow processes", hours: 6 },
                    { task: "Define email data mapping rules", hours: 6 },
                    { task: "Support email classification logic", hours: 5 },
                    { task: "Validate business rules for email parsing", hours: 5 },
                    { task: "Coordinate with business stakeholders", hours: 4 },
                    { task: "Create email processing documentation", hours: 3 },
                    { task: "Support UAT for email features", hours: 3 }
                ],
                successMetrics: ["Requirements clarity", "Process efficiency", "Stakeholder satisfaction", "Documentation completeness"],
                interfaces: ["Product Owner", "Email Engineers", "Business Users"]
            },
            "halo-bi-developer": {
                title: "HaloMD BI Developer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "BI developer creating analytics dashboards and reports for the platform",
                responsibilities: [
                    { task: "Develop BI dashboards and reports", hours: 12 },
                    { task: "Build data visualizations", hours: 8 },
                    { task: "Create KPI metrics and scorecards", hours: 6 },
                    { task: "Optimize report performance", hours: 4 },
                    { task: "Integrate with BI tools (Tableau/PowerBI)", hours: 5 },
                    { task: "Support ad-hoc analytics requests", hours: 3 },
                    { task: "Document BI solutions", hours: 2 },
                    { task: "Train users on dashboards", hours: 2 }
                ],
                successMetrics: ["Dashboard adoption rate", "Report accuracy", "Query performance", "User satisfaction"],
                interfaces: ["Analytics Engineers", "Business Leaders", "Product Owners"]
            },
            "halo-pipeline-ba": {
                title: "HaloMD Business Analyst - Pipeline Health",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Business analyst supporting customer pipeline health monitoring and process optimization",
                responsibilities: [
                    { task: "Monitor customer pipeline health metrics", hours: 10 },
                    { task: "Map customer integration processes", hours: 8 },
                    { task: "Create pipeline management playbooks", hours: 6 },
                    { task: "Analyze customer data requirements", hours: 6 },
                    { task: "Support customer workshops", hours: 5 },
                    { task: "Track onboarding metrics", hours: 3 },
                    { task: "Optimize pipeline workflows", hours: 3 },
                    { task: "Coordinate technical requirements with teams", hours: 3 }
                ],
                successMetrics: ["Pipeline health metrics", "Customer satisfaction", "Process efficiency", "Documentation quality"],
                interfaces: ["Customer Pipeline Health Manager", "Customer Success", "Technical Teams"]
            },
            
            "hakkoda-customer-pipeline-em": {
                title: "Hakkoda Customer Pipeline Health Manager",
                category: "leadership",
                level: "Manager",
                fte: 0.6,
                timing: "now",
                description: "Manager focused on customer onboarding process automation and V2 migration coordination",
                responsibilities: [
                    { task: "Document and automate customer onboarding process end-to-end", hours: 8 },
                    { task: "Capture tribal knowledge and build onboarding runbook", hours: 4 },
                    { task: "Train V2 team on onboarding process and tools", hours: 3 },
                    { task: "Onboard first customer via new automated process", hours: 4 },
                    { task: "Meet with customer executives on pipeline health", hours: 3 },
                    { task: "Support V1 to V2 customer migration planning", hours: 3 },
                    { task: "Track new customer pipeline and conversion metrics", hours: 2 },
                    { task: "Manage customer success handoffs and transitions", hours: 2 }
                ],
                successMetrics: [
                    "Customer onboarding process documented and automated",
                    "First customer onboarded via new process",
                    "Onboarding time reduced by 50%",
                    "V2 team fully trained on process",
                    "Zero onboarding knowledge gaps"
                ],
                interfaces: ["Executive Sponsor", "Customer Success", "Product Owners", "V2 Engineering Team"]
            },
            "hakkoda-analytics-engineer": {
                title: "Hakkoda Analytics Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "next",
                description: "Engineer implementing enterprise data models and generating meaningful analytics",
                responsibilities: [
                    { task: "Implement claims enterprise data model", hours: 7 },
                    { task: "Build disputes and awards analytics", hours: 6 },
                    { task: "Create invoice reconciliation reports", hours: 5 },
                    { task: "Develop and test new analytics features", hours: 6 },
                    { task: "Generate meaningful business analytics", hours: 7 },
                    { task: "Build executive leadership dashboards", hours: 6 },
                    { task: "Develop revenue recovery metrics", hours: 4 },
                    { task: "Support Halo leadership reporting needs", hours: 2 },
                    { task: "Document data model relationships", hours: 2 }
                ],
                successMetrics: ["Report performance", "Data accuracy", "Dashboard adoption"],
                interfaces: ["Lead Engineers", "QA Engineer", "Product Owner"]
            },
            "lead-fullstack": {
                title: "Lead Fullstack Engineer",
                category: "technical",
                level: "Lead",
                fte: 1.0,
                timing: "now",
                description: "Technical lead for Arbit V2 full-stack development",
                responsibilities: [
                    { task: "Lead frontend and backend development", hours: 8 },
                    { task: "Define technical architecture patterns", hours: 5 },
                    { task: "Lead development and testing of new features", hours: 8 },
                    { task: "Mentor development team", hours: 4 },
                    { task: "Review pull requests", hours: 6 },
                    { task: "Optimize application performance", hours: 4 },
                    { task: "Implement security best practices", hours: 3 },
                    { task: "Coordinate with platform team", hours: 2 },
                    { task: "Drive technical innovation", hours: 2 }
                ],
                workstreamSuccessMetrics: [
                    "Feature delivery velocity",
                    "Application response time < 200ms",
                    "Code coverage > 80%",
                    "UI/UX satisfaction score > 4/5",
                    "Zero security vulnerabilities"
                ],
                successMetrics: [
                    "Application performance",
                    "Code review velocity",
                    "Team productivity",
                    "Technical debt management",
                    "Security audit results"
                ],
                interfaces: ["Architect", "Product Owner", "UI/UX", "Platform Team"]
            },
            "fullstack-engineer": {
                title: "Fullstack Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Full-stack developer building Arbit V2 application features",
                responsibilities: [
                    { task: "Develop frontend components", hours: 16 },
                    { task: "Connect and test backend APIs", hours: 4 },
                    { task: "Develop and test new application features", hours: 8 },
                    { task: "Write unit and integration tests", hours: 6 },
                    { task: "Participate in design reviews", hours: 2 },
                    { task: "Fix bugs and issues", hours: 4 },
                    { task: "Optimize code performance", hours: 2 },
                    { task: "Document components", hours: 1 },
                    { task: "Support deployments", hours: 1 }
                ],
                successMetrics: [
                    "Feature completion rate",
                    "Code quality scores",
                    "Bug resolution time",
                    "Test coverage",
                    "Peer feedback"
                ],
                interfaces: ["Lead Fullstack", "UI/UX", "QA Team", "Product Owner"]
            },
            "uiux-ba": {
                title: "UI/UX Business Analyst",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Hybrid role combining user experience design with business analysis",
                responsibilities: [
                    { task: "Conduct user research and interviews", hours: 12 },
                    { task: "Create wireframes and prototypes", hours: 8 },
                    { task: "Design user interfaces", hours: 10 },
                    { task: "Perform usability testing", hours: 3 },
                    { task: "Document business requirements", hours: 8 },
                    { task: "Create process flows", hours: 2 },
                    { task: "Facilitate design workshops", hours: 1 }
                ],
                successMetrics: [
                    "User satisfaction scores",
                    "Design iteration efficiency",
                    "Requirement clarity",
                    "Usability test results",
                    "Stakeholder approval rate"
                ],
                interfaces: ["Product Owner", "Development Team", "End Users", "Stakeholders"]
            },
            "backend-lead": {
                title: "Backend Lead Engineer",
                category: "technical",
                level: "Lead",
                fte: 1.0,
                timing: "now",
                description: "Technical lead for backend services and data model",
                responsibilities: [
                    { task: "Design backend architecture", hours: 5 },
                    { task: "Lead API development", hours: 8 },
                    { task: "Lead backend feature development and testing", hours: 7 },
                    { task: "Define data models", hours: 5 },
                    { task: "Optimize database performance", hours: 4 },
                    { task: "Implement caching strategies", hours: 3 },
                    { task: "Ensure API security", hours: 4 },
                    { task: "Manage microservices", hours: 3 },
                    { task: "Code review and mentoring", hours: 5 }
                ],
                workstreamSuccessMetrics: [
                    "API response time < 100ms",
                    "99.9% uptime SLA",
                    "Database query performance",
                    "API documentation completeness",
                    "Zero critical security issues"
                ],
                successMetrics: [
                    "API response times",
                    "System uptime",
                    "Database performance",
                    "API documentation quality",
                    "Security compliance"
                ],
                interfaces: ["Architect", "Frontend Team", "Platform Team", "DevOps"]
            },
            "backend-engineer": {
                title: "Backend Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "Backend developer focused on services and data layer",
                responsibilities: [
                    { task: "Develop backend services", hours: 10 },
                    { task: "Implement data access layer", hours: 6 },
                    { task: "Write API endpoints", hours: 8 },
                    { task: "Develop and test new backend features", hours: 8 },
                    { task: "Create database migrations", hours: 2 },
                    { task: "Implement business logic", hours: 5 },
                    { task: "Write unit tests", hours: 4 },
                    { task: "Performance optimization", hours: 2 },
                    { task: "API documentation", hours: 2 }
                ],
                successMetrics: [
                    "Code delivery velocity",
                    "API reliability",
                    "Test coverage",
                    "Performance benchmarks",
                    "Documentation quality"
                ],
                interfaces: ["Backend Lead", "Frontend Team", "QA", "DevOps"]
            },
            "ai-engineer": {
                title: "AI Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "next",
                description: "Machine learning engineer implementing AI capabilities",
                responsibilities: [
                    { task: "Develop ML models", hours: 10 },
                    { task: "Implement NLP solutions", hours: 8 },
                    { task: "Develop and test new AI features", hours: 8 },
                    { task: "Build ML pipelines", hours: 5 },
                    { task: "Deploy models to production", hours: 3 },
                    { task: "Monitor model performance", hours: 3 },
                    { task: "Create training datasets", hours: 4 },
                    { task: "Optimize model inference", hours: 2 },
                    { task: "Implement MLOps practices", hours: 2 }
                ],
                successMetrics: [
                    "Model accuracy metrics",
                    "Inference latency",
                    "Model deployment frequency",
                    "Data pipeline reliability",
                    "Business metric impact"
                ],
                interfaces: ["AI Director", "Data Teams", "Backend Team", "Product Owner"]
            },
            "devops-halo": {
                title: "Halo DevOps Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "now",
                description: "DevOps engineer responsible for CI/CD pipelines, infrastructure, and deployment automation for Arbit V2",
                responsibilities: [
                    { task: "Design and maintain CI/CD pipelines", hours: 7 },
                    { task: "Manage cloud infrastructure (AWS/Azure)", hours: 8 },
                    { task: "Implement infrastructure as code (Terraform/CloudFormation)", hours: 5 },
                    { task: "Develop and test infrastructure automation", hours: 6 },
                    { task: "Configure monitoring and alerting systems", hours: 4 },
                    { task: "Automate deployment processes", hours: 4 },
                    { task: "Ensure security best practices", hours: 3 },
                    { task: "Manage containerization (Docker/Kubernetes)", hours: 3 },
                    { task: "Optimize system performance and costs", hours: 3 },
                    { task: "Support production incidents and troubleshooting", hours: 5 }
                ],
                workstreamSuccessMetrics: [
                    "Deployment frequency > 10/week",
                    "Mean time to recovery < 30 minutes",
                    "Infrastructure automation coverage > 95%",
                    "Zero security vulnerabilities in pipeline",
                    "Cost optimization savings > 20%"
                ],
                successMetrics: [
                    "Pipeline reliability (>99.9%)",
                    "Deployment success rate",
                    "Infrastructure uptime",
                    "Security compliance score",
                    "Automation coverage"
                ],
                interfaces: ["Architect", "Lead Engineers", "Security Team", "Cloud Provider Support"]
            },
            // NEXT PHASE ROLES
            "halo-analytics-ba": {
                title: "HaloMD Analytics Business Analyst",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "next",
                description: "Business analyst focused on analytics requirements and dashboard design for revenue recovery metrics",
                responsibilities: [
                    { task: "Define analytics requirements", hours: 10 },
                    { task: "Design dashboard wireframes", hours: 8 },
                    { task: "Document KPI specifications", hours: 6 },
                    { task: "Validate analytics data accuracy", hours: 6 },
                    { task: "Support stakeholder workshops", hours: 5 },
                    { task: "Create analytics documentation", hours: 3 },
                    { task: "Coordinate with BI developers", hours: 4 }
                ],
                successMetrics: [
                    "Dashboard adoption rate",
                    "KPI definition completeness",
                    "Stakeholder satisfaction",
                    "Analytics accuracy"
                ],
                interfaces: ["Analytics Engineers", "BI Developer", "Product Owners", "Business Leaders"]
            },
            "halo-revenue-ba": {
                title: "HaloMD Revenue Recovery Business Analyst",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "next",
                description: "Business analyst specialized in revenue recovery processes and payment reconciliation workflows",
                responsibilities: [
                    { task: "Map revenue recovery workflows", hours: 10 },
                    { task: "Define payment matching rules", hours: 8 },
                    { task: "Document RARC code handling", hours: 6 },
                    { task: "Analyze payer patterns", hours: 6 },
                    { task: "Create recovery playbooks", hours: 5 },
                    { task: "Support billing integrations", hours: 4 },
                    { task: "Track recovery metrics", hours: 3 }
                ],
                successMetrics: [
                    "Recovery rate improvement",
                    "Process efficiency gains",
                    "Rule accuracy",
                    "Documentation quality"
                ],
                interfaces: ["Revenue Engineers", "Product Owner", "Billing Team", "Customer Success"]
            },
            "halo-product-owner-snowflake": {
                title: "HaloMD Product Owner - Snowflake",
                category: "leadership",
                level: "Senior Manager",
                fte: 1.0,
                timing: "next",
                description: "Halo-side product owner for Snowflake platform ensuring alignment with internal objectives",
                responsibilities: [
                    { task: "Define Halo-specific requirements", hours: 8 },
                    { task: "Prioritize internal stakeholder needs", hours: 8 },
                    { task: "Review vendor deliverables", hours: 6 },
                    { task: "Manage internal backlog", hours: 6 },
                    { task: "Coordinate with Hakkoda PO", hours: 5 },
                    { task: "Ensure compliance requirements", hours: 4 },
                    { task: "Drive internal adoption", hours: 5 }
                ],
                successMetrics: [
                    "Internal stakeholder satisfaction",
                    "Requirement clarity",
                    "Adoption metrics",
                    "Compliance adherence"
                ],
                interfaces: ["Hakkoda Product Owner", "Internal Stakeholders", "Compliance Team", "Executive Sponsors"]
            },
            "halo-product-owner-arbit": {
                title: "HaloMD Product Owner - Arbit V2",
                category: "leadership",
                level: "Senior Manager",
                fte: 1.0,
                timing: "next",
                description: "Halo-side product owner for Arbit V2 application ensuring user needs are met",
                responsibilities: [
                    { task: "Gather internal user feedback", hours: 8 },
                    { task: "Define user experience requirements", hours: 8 },
                    { task: "Prioritize feature requests", hours: 6 },
                    { task: "Review UI/UX designs", hours: 6 },
                    { task: "Coordinate with Hakkoda PO", hours: 5 },
                    { task: "Manage change requests", hours: 4 },
                    { task: "Drive user adoption", hours: 5 }
                ],
                successMetrics: [
                    "User satisfaction scores",
                    "Feature adoption rates",
                    "Requirement completeness",
                    "Time to market"
                ],
                interfaces: ["Hakkoda Product Owner", "End Users", "UI/UX Team", "Training Team"]
            },
            // LATER PHASE ROLES
            "hakkoda-fullstack-2": {
                title: "Hakkoda Fullstack Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "later",
                description: "Additional fullstack engineer for expanded Arbit V2 development in 2026",
                responsibilities: [
                    { task: "Develop new application features", hours: 14 },
                    { task: "Build responsive UI components", hours: 10 },
                    { task: "Implement backend APIs", hours: 8 },
                    { task: "Write comprehensive tests", hours: 5 },
                    { task: "Optimize application performance", hours: 3 },
                    { task: "Support production deployments", hours: 2 }
                ],
                successMetrics: [
                    "Feature velocity",
                    "Code quality metrics",
                    "Test coverage",
                    "Performance benchmarks"
                ],
                interfaces: ["Lead Fullstack", "Product Owner", "QA Team", "DevOps"]
            },
            "hakkoda-fullstack-3": {
                title: "Hakkoda Fullstack Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "later",
                description: "Additional fullstack engineer for expanded Arbit V2 development in 2026",
                responsibilities: [
                    { task: "Develop new application features", hours: 14 },
                    { task: "Build responsive UI components", hours: 10 },
                    { task: "Implement backend APIs", hours: 8 },
                    { task: "Write comprehensive tests", hours: 5 },
                    { task: "Optimize application performance", hours: 3 },
                    { task: "Support production deployments", hours: 2 }
                ],
                successMetrics: [
                    "Feature velocity",
                    "Code quality metrics",
                    "Test coverage",
                    "Performance benchmarks"
                ],
                interfaces: ["Lead Fullstack", "Product Owner", "QA Team", "DevOps"]
            },
            "hakkoda-fullstack-4": {
                title: "Hakkoda Fullstack Engineer",
                category: "technical",
                level: "Senior",
                fte: 1.0,
                timing: "later",
                description: "Additional fullstack engineer for expanded Arbit V2 development in 2026",
                responsibilities: [
                    { task: "Develop new application features", hours: 14 },
                    { task: "Build responsive UI components", hours: 10 },
                    { task: "Implement backend APIs", hours: 8 },
                    { task: "Write comprehensive tests", hours: 5 },
                    { task: "Optimize application performance", hours: 3 },
                    { task: "Support production deployments", hours: 2 }
                ],
                successMetrics: [
                    "Feature velocity",
                    "Code quality metrics",
                    "Test coverage",
                    "Performance benchmarks"
                ],
                interfaces: ["Lead Fullstack", "Product Owner", "QA Team", "DevOps"]
            }
        }
    },
    structure: {
        program: {
            id: "program",
            name: "HaloMD Modernization Program",
            roles: ["executive-sponsor", "halo-executive-sponsor", "strategic-program-director", "halo-enterprise-architect"],
            children: ["project1", "project2"]
        },
        workstreamDefinitions: {
            "ws1.1": {
                name: "Claims Ingestion",
                project: "HaloMD Snowflake Platform",
                mission: "Establish a robust, scalable, and automated claims data ingestion pipeline that ensures accurate and timely processing of healthcare claims while maintaining data integrity and compliance.",
                purpose: "To create a modern, cloud-native claims processing infrastructure that replaces legacy systems, reduces manual intervention, and enables real-time analytics on claims data.",
                goals: [
                    "Automate 95% of claims ingestion processes",
                    "Reduce claims processing time from days to hours",
                    "Achieve 99.9% data accuracy in claims processing",
                    "Enable real-time validation and error handling",
                    "Support multiple claims formats and sources"
                ],
                deliverables: {
                    now: [
                        "Core claims ingestion pipeline architecture",
                        "Automated validation and error handling framework",
                        "Initial integration with top 3 payer systems",
                        "Basic monitoring and alerting dashboard"
                    ],
                    next: [
                        "Advanced data quality scoring system",
                        "ML-based anomaly detection for claims",
                        "Integration with additional 5 payer systems",
                        "Self-healing pipeline capabilities"
                    ],
                    later: [
                        "Full automation of all payer integrations",
                        "Predictive analytics for claims processing",
                        "Industry-leading processing benchmarks"
                    ]
                }
            },
            "ws1.2": {
                name: "Email Ingestion",
                project: "HaloMD Snowflake Platform",
                mission: "Transform unstructured email communications into structured, actionable data that enhances patient care coordination and operational efficiency.",
                purpose: "To intelligently process, categorize, and extract critical information from email communications, enabling automated workflows and reducing manual email processing by 80%.",
                goals: [
                    "Process 100% of incoming healthcare emails automatically",
                    "Extract key data points with 95% accuracy",
                    "Reduce email response time by 75%",
                    "Enable intelligent routing based on content",
                    "Maintain HIPAA compliance for all email data"
                ],
                deliverables: {
                    now: [
                        "Email ingestion and parsing engine",
                        "NLP-based content extraction system",
                        "Automated categorization and routing",
                        "Email data warehouse schema"
                    ],
                    next: [
                        "Advanced sentiment analysis",
                        "Automated response generation for common queries",
                        "Integration with customer service platform",
                        "Email analytics dashboard"
                    ],
                    later: [
                        "AI-powered email assistant",
                        "Predictive routing based on historical patterns",
                        "Full automation of email-based workflows"
                    ]
                }
            },
            "ws1.3": {
                name: "Revenue Recovery",
                project: "HaloMD Snowflake Platform",
                mission: "Maximize revenue capture and minimize revenue leakage through intelligent identification, analysis, and recovery of underpaid or denied claims.",
                purpose: "To build an advanced revenue recovery engine that identifies revenue opportunities, automates appeals processes, and provides actionable insights to increase overall revenue by 15-20%.",
                goals: [
                    "Identify 100% of underpaid claims",
                    "Automate 80% of appeals processes",
                    "Increase revenue recovery by 20%",
                    "Reduce days in A/R by 30%",
                    "Provide real-time revenue insights"
                ],
                deliverables: {
                    now: [
                        "Underpayment detection algorithm",
                        "Automated appeals generation system",
                        "Revenue leakage dashboard",
                        "Denial management workflow"
                    ],
                    next: [
                        "Predictive denial prevention system",
                        "ML-based payment prediction model",
                        "Automated payer negotiation insights",
                        "Revenue optimization recommendations"
                    ],
                    later: [
                        "AI-driven revenue maximization platform",
                        "Real-time contract optimization",
                        "Industry benchmark analytics"
                    ]
                }
            },
            "ws1.4": {
                name: "Analytics",
                project: "HaloMD Snowflake Platform",
                mission: "Empower data-driven decision making through comprehensive analytics, actionable insights, and predictive intelligence across all healthcare operations.",
                purpose: "To create a unified analytics platform that transforms raw healthcare data into strategic insights, enabling proactive decision-making and operational excellence.",
                goals: [
                    "Provide real-time operational dashboards",
                    "Enable self-service analytics for business users",
                    "Deliver predictive insights for key metrics",
                    "Reduce report generation time by 90%",
                    "Achieve single source of truth for all metrics"
                ],
                deliverables: {
                    now: [
                        "Core analytics data model",
                        "Executive dashboard suite",
                        "Operational KPI tracking",
                        "Standard report library"
                    ],
                    next: [
                        "Predictive analytics models",
                        "Self-service analytics platform",
                        "Advanced visualization capabilities",
                        "Automated insight generation"
                    ],
                    later: [
                        "AI-powered business intelligence",
                        "Prescriptive analytics recommendations",
                        "Real-time decision support system"
                    ]
                }
            },
            "ws1.5": {
                name: "Customer Pipeline Health",
                project: "HaloMD Snowflake Platform",
                mission: "Ensure seamless customer onboarding, maximize customer success, and maintain optimal pipeline health through proactive monitoring and intervention.",
                purpose: "To establish a comprehensive customer health monitoring system that predicts and prevents customer issues, accelerates onboarding, and maximizes customer lifetime value.",
                goals: [
                    "Reduce customer onboarding time by 50%",
                    "Achieve 95% customer satisfaction score",
                    "Predict customer churn 90 days in advance",
                    "Automate 70% of customer health checks",
                    "Increase customer lifetime value by 30%"
                ],
                deliverables: {
                    now: [
                        "Customer health scoring system",
                        "Onboarding automation framework",
                        "Pipeline tracking dashboard",
                        "Customer success playbooks"
                    ],
                    next: [
                        "Predictive churn model",
                        "Automated intervention workflows",
                        "Customer journey analytics",
                        "Success metrics automation"
                    ],
                    later: [
                        "AI-driven customer success platform",
                        "Prescriptive customer recommendations",
                        "Full customer lifecycle automation"
                    ]
                }
            },
            "ws2.1": {
                name: "Frontend Application",
                project: "Halo Arbit V2 Software Application",
                mission: "Deliver an intuitive, performant, and beautiful user experience that delights users and dramatically improves workflow efficiency.",
                purpose: "To create a modern, responsive frontend application that reduces user task completion time by 60% while maintaining the highest standards of usability and accessibility.",
                goals: [
                    "Achieve sub-second page load times",
                    "Reduce user clicks by 50% for common tasks",
                    "Maintain 99.9% application uptime",
                    "Support all modern browsers and devices",
                    "Achieve WCAG 2.1 AA accessibility compliance"
                ],
                deliverables: {
                    now: [
                        "Core UI component library",
                        "Responsive design system",
                        "User authentication and authorization",
                        "Main application workflows"
                    ],
                    next: [
                        "Advanced data visualization components",
                        "Real-time collaboration features",
                        "Progressive web app capabilities",
                        "Comprehensive user analytics"
                    ],
                    later: [
                        "AI-powered user assistance",
                        "Voice-enabled interfaces",
                        "Augmented reality features"
                    ]
                }
            },
            "ws2.2": {
                name: "Backend/Data Model",
                project: "Halo Arbit V2 Software Application",
                mission: "Build a scalable, secure, and performant backend infrastructure that serves as the robust foundation for all application functionality.",
                purpose: "To architect and implement a cloud-native backend system that handles millions of transactions daily while maintaining sub-100ms response times and 99.99% availability.",
                goals: [
                    "Process 1M+ transactions daily",
                    "Maintain <100ms API response times",
                    "Achieve 99.99% system availability",
                    "Enable horizontal scaling capabilities",
                    "Implement comprehensive security measures"
                ],
                deliverables: {
                    now: [
                        "Microservices architecture",
                        "RESTful API framework",
                        "Database schema and optimization",
                        "Authentication and authorization system"
                    ],
                    next: [
                        "GraphQL API layer",
                        "Event-driven architecture",
                        "Advanced caching strategies",
                        "Real-time data synchronization"
                    ],
                    later: [
                        "Serverless architecture migration",
                        "Global distribution capabilities",
                        "Self-optimizing infrastructure"
                    ]
                }
            },
            "ws2.3": {
                name: "AI Use Cases",
                project: "Halo Arbit V2 Software Application",
                mission: "Leverage artificial intelligence to transform healthcare operations through intelligent automation, predictive insights, and decision support.",
                purpose: "To integrate cutting-edge AI capabilities that automate complex tasks, provide predictive insights, and augment human decision-making to improve outcomes by 40%.",
                goals: [
                    "Automate 60% of manual processes",
                    "Achieve 95% accuracy in predictions",
                    "Reduce decision-making time by 70%",
                    "Enable natural language interactions",
                    "Provide explainable AI recommendations"
                ],
                deliverables: {
                    now: [
                        "Document understanding and extraction",
                        "Automated classification systems",
                        "Basic predictive models",
                        "AI model deployment pipeline"
                    ],
                    next: [
                        "Natural language processing capabilities",
                        "Advanced machine learning models",
                        "Computer vision integration",
                        "AI-powered recommendations engine"
                    ],
                    later: [
                        "Autonomous decision-making systems",
                        "Continuous learning capabilities",
                        "Industry-specific AI solutions"
                    ]
                }
            },
            "ws2.4": {
                name: "DevOps & Infrastructure",
                project: "Halo Arbit V2 Software Application",
                mission: "Enable rapid, reliable, and secure software delivery through world-class DevOps practices and infrastructure automation.",
                purpose: "To establish a fully automated CI/CD pipeline and infrastructure platform that enables 10+ deployments daily with zero downtime and instant rollback capabilities.",
                goals: [
                    "Achieve 10+ deployments per day",
                    "Reduce deployment time to <10 minutes",
                    "Maintain 99.99% infrastructure uptime",
                    "Enable instant rollback capabilities",
                    "Automate 100% of infrastructure provisioning"
                ],
                deliverables: {
                    now: [
                        "CI/CD pipeline implementation",
                        "Infrastructure as code framework",
                        "Automated testing suite",
                        "Monitoring and alerting system"
                    ],
                    next: [
                        "Blue-green deployment strategy",
                        "Chaos engineering practices",
                        "Advanced observability platform",
                        "Self-healing infrastructure"
                    ],
                    later: [
                        "AI-driven operations (AIOps)",
                        "Predictive scaling and optimization",
                        "Zero-touch operations"
                    ]
                }
            }
        },
        projects: {
            project1: {
                id: "project1",
                name: "HaloMD Data Platform",
                roles: ["architect-snowflake", "product-owner-snowflake", "engagement-manager-snowflake", "halo-product-owner-snowflake"],
                workstreams: [
                    {
                        id: "ws1.1",
                        name: "Claims Ingestion",
                        roles: ["lead-engineer-halo", "hakkoda-lead-claims-engineer", "hakkoda-claims-engineer", "hakkoda-qa-claims-engineer"],
                        allocation: { "lead-engineer-halo": 0.25, "hakkoda-lead-claims-engineer": 1.0, "hakkoda-claims-engineer": 1.0, "hakkoda-qa-claims-engineer": 1.0 }
                    },
                    {
                        id: "ws1.2",
                        name: "Email Ingestion",
                        roles: ["lead-engineer-halo", "hakkoda-lead-email-engineer", "hakkoda-email-engineer", "hakkoda-email-engineer", "hakkoda-qa-email-engineer", "halo-email-ba"],
                        allocation: { "lead-engineer-halo": 0.25, "hakkoda-lead-email-engineer": 1.0, "hakkoda-email-engineer": 2.0, "hakkoda-qa-email-engineer": 1.0, "halo-email-ba": 1.0 }
                    },
                    {
                        id: "ws1.3",
                        name: "Revenue Recovery",
                        roles: ["lead-engineer-halo", "hakkoda-lead-revenue-engineer", "hakkoda-revenue-engineer", "hakkoda-revenue-engineer-2", "halo-revenue-ba"],
                        allocation: { "lead-engineer-halo": 0.25, "hakkoda-lead-revenue-engineer": 1.0, "hakkoda-revenue-engineer": 1.0, "hakkoda-revenue-engineer-2": 1.0, "halo-revenue-ba": 1.0 }
                    },
                    {
                        id: "ws1.4",
                        name: "Analytics",
                        roles: ["lead-engineer-halo", "hakkoda-lead-analytics-engineer", "hakkoda-analytics-engineer", "halo-bi-developer", "halo-analytics-ba"],
                        allocation: { "lead-engineer-halo": 0.25, "hakkoda-lead-analytics-engineer": 1.0, "hakkoda-analytics-engineer": 1.0, "halo-bi-developer": 1.0, "halo-analytics-ba": 1.0 }
                    },
                    {
                        id: "ws1.5",
                        name: "Customer Pipeline Health",
                        roles: ["hakkoda-customer-pipeline-em", "halo-pipeline-ba"],
                        allocation: { "hakkoda-customer-pipeline-em": 0.6, "halo-pipeline-ba": 1.0 }
                    }
                ]
            },
            project2: {
                id: "project2",
                name: "Halo Arbit V2 Software Application",
                roles: ["architect-arbit", "product-owner-arbit", "engagement-manager-arbit", "halo-product-owner-arbit"],
                workstreams: [
                    {
                        id: "ws2.1",
                        name: "Frontend Application",
                        roles: ["lead-fullstack", "fullstack-engineer", "uiux-ba", "hakkoda-fullstack-2", "hakkoda-fullstack-3", "hakkoda-fullstack-4"],
                        allocation: { "lead-fullstack": 1.0, "fullstack-engineer": 1.0, "uiux-ba": 1.0, "hakkoda-fullstack-2": 1.0, "hakkoda-fullstack-3": 1.0, "hakkoda-fullstack-4": 1.0 }
                    },
                    {
                        id: "ws2.2",
                        name: "Backend/Data Model",
                        roles: ["backend-lead", "backend-engineer"],
                        allocation: { "backend-lead": 1.0, "backend-engineer": 1.0 }
                    },
                    {
                        id: "ws2.3",
                        name: "AI Use Cases",
                        roles: ["ai-director", "ai-engineer"],
                        allocation: { "ai-director": 0.25, "ai-engineer": 1.0 }
                    },
                    {
                        id: "ws2.4",
                        name: "DevOps & Infrastructure",
                        roles: ["devops-halo"],
                        allocation: { "devops-halo": 1.0 }
                    }
                ]
            }
        }
    },
    raciMatrix: {
        responsibilities: [
            "Program Strategy & Vision",
            "Budget & Resource Management",
            "Technical Architecture",
            "Product Roadmap",
            "Sprint Planning & Execution",
            "Quality Assurance",
            "Stakeholder Communication",
            "Risk Management",
            "Vendor Management",
            "Team Performance",
            "Compliance & Security",
            "Change Management"
        ]
    },
    roster: [
        // HaloMD Team
        { name: "Louis Mangicapra", role: "unassigned", allocation: 50, startDate: "", skills: "", team: "Halo" },
        { name: "Jeffrey Jordan", role: "unassigned", allocation: 100, startDate: "", skills: "", team: "Halo" },
        { name: "Joseph Lewright", role: "unassigned", allocation: 100, startDate: "", skills: "", team: "Halo" },
        { name: "Rohith Nambi", role: "unassigned", allocation: 100, startDate: "", skills: "", team: "Halo" },
        { name: "Jon Galvan", role: "unassigned", allocation: 100, startDate: "", skills: "", team: "Halo" },
        { name: "Lauren Crenshaw", role: "unassigned", allocation: 100, startDate: "", skills: "", team: "Halo" },
        { name: "Joe Bell", role: "unassigned", allocation: 50, startDate: "", skills: "", team: "Halo" },
        // Snowflake Team - Claims Workstream
        { name: "Jimmy Monge", role: "unassigned", allocation: 100, startDate: "", skills: "Lead - Claims Workstream", team: "Hakkoda" },
        { name: "Gerald Leon", role: "unassigned", allocation: 100, startDate: "", skills: "Claims Workstream", team: "Hakkoda" },
        { name: "Rafael Alvarado", role: "unassigned", allocation: 100, startDate: "", skills: "Claims Workstream", team: "Hakkoda" },
        { name: "German Zumbado", role: "unassigned", allocation: 100, startDate: "", skills: "EM - Claims Workstream", team: "Hakkoda" },

        // Snowflake Team - Email Workstream
        { name: "Luis Cortes", role: "unassigned", allocation: 100, startDate: "", skills: "Lead - Email Workstream", team: "Hakkoda" },
        { name: "Victor Mena", role: "unassigned", allocation: 100, startDate: "", skills: "Email Workstream", team: "Hakkoda" },
        { name: "Javier (Harry) Alvarado", role: "unassigned", allocation: 100, startDate: "", skills: "Email Workstream", team: "Hakkoda" },
        { name: "Gustavo Orozco", role: "unassigned", allocation: 100, startDate: "", skills: "Email Workstream", team: "Hakkoda" },

        // Snowflake Team - Revenue Recovery Workstream
        { name: "Javier Herrera", role: "unassigned", allocation: 100, startDate: "", skills: "Revenue Recovery Workstream", team: "Hakkoda" },
        { name: "Marcelo Ocampo", role: "unassigned", allocation: 100, startDate: "", skills: "Revenue Recovery Workstream", team: "Hakkoda" },
        { name: "Armando Montiel", role: "unassigned", allocation: 100, startDate: "", skills: "Revenue Recovery Workstream", team: "Hakkoda" },

        // Snowflake Team - Analytics Workstream
        { name: "Gerson Espinoza", role: "unassigned", allocation: 100, startDate: "", skills: "Analytics Workstream", team: "Hakkoda" },

        // Arbit v2 Team
        { name: "JP Feng", role: "unassigned", allocation: 100, startDate: "", skills: "Arbit v2 Team", team: "Hakkoda" },
        { name: "Ruben Carrera", role: "unassigned", allocation: 100, startDate: "", skills: "Arbit v2 Team", team: "Hakkoda" },
        { name: "Pamela Guerrero", role: "unassigned", allocation: 100, startDate: "", skills: "Arbit v2 Team", team: "Hakkoda" },
        { name: "Daniel Rodriguez", role: "unassigned", allocation: 100, startDate: "", skills: "Arbit v2 Team", team: "Hakkoda" },
        { name: "Claire Heger", role: "unassigned", allocation: 100, startDate: "", skills: "Arbit v2 Team", team: "Hakkoda" },
        { name: "Erin Davidson", role: "unassigned", allocation: 100, startDate: "", skills: "Arbit v2 Team", team: "Hakkoda" }
    ]
};

// Global variable to track current timing filter
let currentTimingFilter = 'now';

// Configuration data for phases
let phaseConfig = {
    now: {
        start: '2024-01-01',
        end: '2025-11-14'
    },
    next: {
        start: '2025-11-15',
        end: '2026-01-15'
    },
    later: {
        start: '2026-01-16',
        end: '2027-01-15'
    }
};

// Role start dates configuration
let roleStartDates = {};

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    initializeTabs();
    renderOrgChart();
    renderRoleDefinitions();
    renderCapacityPlanning();
    renderRACIMatrix();
    renderRoster();
    initializeModals();
    loadConfigData();
    renderConfigPage();

    // Check if workstreamDefinitions exists before rendering
    if (programData && programData.structure && programData.structure.workstreamDefinitions) {
        renderWorkstreamDefinitions();
    } else {
        console.log('Workstream definitions will be rendered when tab is clicked');
    }

    // Add event listener for role edit form
    const roleForm = document.getElementById('roleEditForm');
    if (roleForm) {
        roleForm.addEventListener('submit', function(e) {
            e.preventDefault();
            saveRoleFromModal();
        });
    }
});

// Tab navigation
function initializeTabs() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.dataset.tab;

            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            button.classList.add('active');
            document.getElementById(targetTab).classList.add('active');

            // Special handling for Definitions tab
            if (targetTab === 'roles') {
                // Ensure workstream definitions are rendered when tab is first opened
                const grid = document.getElementById('workstreamsGrid');
                if (grid && grid.children.length === 0) {
                    renderWorkstreamDefinitions();
                }
            }
        });
    });
}

// Organization Chart Rendering
function renderOrgChart() {
    const chartContainer = document.getElementById('orgChart');
    chartContainer.innerHTML = '';

    const programNode = createOrgNode(programData.structure.program, 'program');
    chartContainer.appendChild(programNode);

    const projectsContainer = document.createElement('div');
    projectsContainer.className = 'projects-container';

    Object.values(programData.structure.projects).forEach(project => {
        const projectNode = createProjectNode(project);
        projectsContainer.appendChild(projectNode);
    });

    chartContainer.appendChild(projectsContainer);

    // Update resource counts
    updateResourceCounts();
}

function createOrgNode(data, type) {
    const node = document.createElement('div');
    node.className = `org-node ${type}-node`;

    const header = document.createElement('div');
    header.className = 'node-header';
    header.innerHTML = `<h3>${data.name}</h3>`;
    node.appendChild(header);

    const rolesContainer = document.createElement('div');
    rolesContainer.className = 'node-roles';

    data.roles.forEach(roleId => {
        const role = findRole(roleId);
        if (role) {
            const roleDiv = createRoleCard(role, roleId);
            if (roleDiv) {
                rolesContainer.appendChild(roleDiv);
            }
        }
    });

    node.appendChild(rolesContainer);
    return node;
}

function createProjectNode(project) {
    const projectContainer = document.createElement('div');
    projectContainer.className = 'project-container';

    const projectHeader = document.createElement('div');
    projectHeader.className = 'project-header';
    projectHeader.innerHTML = `
        <h3>${project.name}</h3>
        <button class="expand-btn" onclick="toggleWorkstreams('${project.id}')">â–¼</button>
    `;
    projectContainer.appendChild(projectHeader);

    const projectRoles = document.createElement('div');
    projectRoles.className = 'project-roles';
    project.roles.forEach(roleId => {
        const role = findRole(roleId);
        if (role) {
            const roleDiv = createRoleCard(role, roleId);
            if (roleDiv) {
                projectRoles.appendChild(roleDiv);
            }
        }
    });
    projectContainer.appendChild(projectRoles);

    const workstreamsContainer = document.createElement('div');
    workstreamsContainer.className = 'workstreams-container';
    workstreamsContainer.id = `ws-${project.id}`;

    project.workstreams.forEach(ws => {
        const wsNode = createWorkstreamNode(ws);
        workstreamsContainer.appendChild(wsNode);
    });

    projectContainer.appendChild(workstreamsContainer);
    return projectContainer;
}

function createWorkstreamNode(workstream) {
    const wsNode = document.createElement('div');
    wsNode.className = 'workstream-node';

    const wsHeader = document.createElement('h4');
    wsHeader.textContent = workstream.name;
    wsNode.appendChild(wsHeader);

    const wsRoles = document.createElement('div');
    wsRoles.className = 'workstream-roles';

    const roleAllocations = {};
    workstream.roles.forEach(roleId => {
        if (!roleAllocations[roleId]) {
            roleAllocations[roleId] = 0;
        }
        roleAllocations[roleId]++;
    });

    Object.entries(roleAllocations).forEach(([roleId, count]) => {
        const role = findRole(roleId);
        if (role) {
            const allocation = workstream.allocation[roleId] || 1.0;
            const roleDiv = createRoleCard(role, roleId, count, allocation);
            if (roleDiv) {
                wsRoles.appendChild(roleDiv);
            }
        }
    });

    wsNode.appendChild(wsRoles);
    return wsNode;
}

function createRoleCard(role, roleId, count = 1, allocation = null) {
    // Check if role should be displayed based on timing filter
    if (!shouldDisplayRole(role)) {
        return null;
    }

    const fte = allocation !== null ? allocation : (role.fte * count);

    if (fte > 1.0) {
        const container = document.createElement('div');
        container.className = 'role-cards-container';

        const fullBoxes = Math.floor(fte);
        const remainder = fte - fullBoxes;

        for (let i = 0; i < fullBoxes; i++) {
            container.appendChild(createSingleRoleCard(role, roleId, 1.0, i + 1, fullBoxes + (remainder > 0 ? 1 : 0)));
        }

        if (remainder > 0.01) {
            container.appendChild(createSingleRoleCard(role, roleId, remainder, fullBoxes + 1, fullBoxes + 1));
        }

        return container;
    } else {
        return createSingleRoleCard(role, roleId, fte);
    }
}

function createSingleRoleCard(role, roleId, fte, boxNumber = null, totalBoxes = null) {
    const roleCard = document.createElement('div');

    const isHalo = role.title.includes('Halo');
    const orgClass = isHalo ? 'halo-role' : 'hakkoda-role';

    // Add phase class based on timing
    let phaseClass = '';
    const roleTiming = role.timing || 'now';
    if (currentTimingFilter === 'next' && roleTiming === 'next') {
        phaseClass = 'next-phase';
    } else if (currentTimingFilter === 'later' && roleTiming === 'later') {
        phaseClass = 'later-phase';
    }

    roleCard.className = `role-card ${orgClass} ${phaseClass}`.trim();
    roleCard.onclick = () => showRoleDetail(roleId);

    const fteClass = fte < 0.5 ? 'fte-low' : fte <= 1.0 ? 'fte-medium' : 'fte-high';
    const boxLabel = boxNumber && totalBoxes > 1 ? ` (${boxNumber}/${totalBoxes})` : '';

    // Find assigned team members for this role
    const assignedMembers = programData.roster.filter(m => m.role === roleId);
    let assignedText = 'Unassigned';
    if (assignedMembers.length > 0) {
        if (boxNumber && totalBoxes > 1) {
            // For split roles, show member based on box number
            const memberIndex = boxNumber - 1;
            if (assignedMembers[memberIndex]) {
                assignedText = `${assignedMembers[memberIndex].name} (${assignedMembers[memberIndex].team})`;
            }
        } else {
            // For single roles or first box, show all assigned members
            assignedText = assignedMembers.map(m => `${m.name} (${m.team})`).join(', ');
        }
    }

    // Calculate total hours for the role
    const totalHours = role.responsibilities.reduce((sum, r) => {
        return sum + (typeof r === 'object' ? r.hours : 0);
    }, 0);

    roleCard.innerHTML = `
        <div class="role-title">${role.title}${boxLabel}</div>
        <div class="role-fte ${fteClass}">${fte.toFixed(2)} FTE${totalHours > 0 ? ` (${totalHours}h/wk)` : ''}</div>
        <div class="role-assigned" id="assigned-${roleId}${boxNumber || ''}">${assignedText}</div>
    `;

    return roleCard;
}

function findRole(roleId) {
    for (const category of Object.values(programData.roles)) {
        if (category[roleId]) {
            return category[roleId];
        }
    }
    return null;
}

// Role Definitions Rendering
function renderRoleDefinitions() {
    const rolesContent = document.getElementById('rolesContent');
    if (!rolesContent) return; // Exit if element doesn't exist

    const allRoles = [];

    Object.entries(programData.roles).forEach(([category, roles]) => {
        if (typeof roles === 'object' && !roles.description) {
            Object.entries(roles).forEach(([roleId, role]) => {
                if (role.title && shouldDisplayRole(role)) {
                    allRoles.push({ ...role, id: roleId, category });
                }
            });
        }
    });

    rolesContent.innerHTML = allRoles.map(role => `
        <div class="role-definition" data-category="${role.category}">
            <h3>${role.title}</h3>
            <div class="role-meta">
                <span class="badge">${role.level}</span>
                <span class="badge">${role.fte} FTE</span>
                <span class="badge category-${role.category}">${role.category}</span>
            </div>
            <p class="role-description">${role.description}</p>
            <div class="role-details">
                <div class="detail-section">
                    <h4>Key Responsibilities</h4>
                    <ul>${role.responsibilities.map(r => {
                        if (typeof r === 'string') return `<li>${r}</li>`;
                        return `<li>${r.task} <span style="color: #666; font-size: 12px;">(${r.hours} hrs/week)</span></li>`;
                    }).join('')}</ul>
                    ${(() => {
                        const totalHours = role.responsibilities.reduce((sum, r) => {
                            return sum + (typeof r === 'object' ? r.hours : 0);
                        }, 0);
                        if (totalHours > 40) {
                            return `<p style="margin-top: 10px; padding: 8px 12px; background: #fef3c7; border-radius: 6px; font-size: 12px; color: #92400e;">âš ï¸ Total: ${totalHours} hrs/week - Consider splitting this role</p>`;
                        }
                        return '';
                    })()}
                </div>
                ${role.workstreamSuccessMetrics ? `
                <div class="detail-section">
                    <h4>Workstream Success Metrics</h4>
                    <ul>${role.workstreamSuccessMetrics.map(m => `<li>${m}</li>`).join('')}</ul>
                </div>
                ` : ''}
                <div class="detail-section">
                    <h4>Success Metrics</h4>
                    <ul>${role.successMetrics.map(m => `<li>${m}</li>`).join('')}</ul>
                </div>
            </div>
            <button class="btn-secondary" onclick="showRoleDetail('${role.id}')">View Full Details</button>
        </div>
    `).join('');

    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const filter = btn.dataset.filter;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            document.querySelectorAll('.role-definition').forEach(def => {
                if (filter === 'all' || def.dataset.category === filter) {
                    def.style.display = 'block';
                } else {
                    def.style.display = 'none';
                }
            });
        });
    });
}

// Capacity Planning
function renderCapacityPlanning() {
    const capacityDetails = document.getElementById('capacityDetails');
    const fteCalculation = calculateTotalFTE();

    document.getElementById('projectedFTE').textContent = fteCalculation.projected.toFixed(2);
    document.getElementById('totalFTE').textContent = fteCalculation.planned.toFixed(2);
    document.getElementById('currentFTE').textContent = fteCalculation.filled.toFixed(2);
    document.getElementById('gapFTE').textContent = fteCalculation.gap.toFixed(2);

    capacityDetails.innerHTML = `
        <div class="capacity-breakdown">
            <h3>FTE Breakdown by Project</h3>
            <div class="capacity-cards">
                ${renderProjectCapacity('project1')}
                ${renderProjectCapacity('project2')}
            </div>
        </div>
        <div class="capacity-breakdown">
            <h3>Role Capacity Analysis</h3>
            <div class="capacity-table">
                ${renderRoleCapacityTable()}
            </div>
        </div>
    `;
}

function calculateTotalFTE() {
    let planned = 0;
    let filled = 0;
    let projected = 0;

    // Calculate planned FTE from role definitions
    programData.structure.program.roles.forEach(roleId => {
        const role = findRole(roleId);
        if (role && shouldDisplayRole(role)) {
            planned += role.fte;

            // Calculate projected FTE based on actual hours
            const totalHours = role.responsibilities.reduce((sum, r) => {
                return sum + (typeof r === 'object' ? r.hours : 0);
            }, 0);
            if (totalHours > 0) {
                projected += totalHours / 40;
            } else {
                projected += role.fte; // Fallback to planned if no hours
            }
        }
    });

    Object.values(programData.structure.projects).forEach(project => {
        project.roles.forEach(roleId => {
            const role = findRole(roleId);
            if (role && shouldDisplayRole(role)) {
                planned += role.fte;

                // Calculate projected FTE based on actual hours
                const totalHours = role.responsibilities.reduce((sum, r) => {
                    return sum + (typeof r === 'object' ? r.hours : 0);
                }, 0);
                if (totalHours > 0) {
                    projected += totalHours / 40;
                } else {
                    projected += role.fte;
                }
            }
        });

        project.workstreams.forEach(ws => {
            Object.entries(ws.allocation).forEach(([roleId, allocation]) => {
                const role = findRole(roleId);
                if (role && shouldDisplayRole(role)) {
                    planned += allocation;

                    // Calculate projected FTE for workstream roles
                    const totalHours = role.responsibilities.reduce((sum, r) => {
                        return sum + (typeof r === 'object' ? r.hours : 0);
                    }, 0);
                    if (totalHours > 0) {
                        // For workstream allocations, scale the projected hours by allocation
                        projected += (totalHours / 40) * allocation;
                    } else {
                        projected += allocation;
                    }
                }
            });
        });
    });

    programData.roster.forEach(member => {
        if (member.role !== 'unassigned') {
            const role = findRole(member.role);
            if (role && shouldDisplayRole(role)) {
                filled += member.allocation / 100;
            }
        } else {
            // Unassigned members are counted as current capacity
            filled += member.allocation / 100;
        }
    });

    return {
        planned: planned,
        projected: projected,
        filled: filled,
        gap: projected - filled  // Gap is now Projected - Current
    };
}

function renderProjectCapacity(projectId) {
    const project = programData.structure.projects[projectId];
    let projectFTE = 0;

    project.roles.forEach(roleId => {
        const role = findRole(roleId);
        if (role && shouldDisplayRole(role)) {
            projectFTE += role.fte;
        }
    });

    project.workstreams.forEach(ws => {
        Object.entries(ws.allocation).forEach(([roleId, allocation]) => {
            const role = findRole(roleId);
            if (role && shouldDisplayRole(role)) {
                projectFTE += allocation;
            }
        });
    });

    return `
        <div class="capacity-card">
            <h4>${project.name}</h4>
            <div class="fte-display">${projectFTE.toFixed(2)} FTE</div>
            <div class="workstream-breakdown">
                ${project.workstreams.map(ws => {
                    let wsFTE = 0;
                    Object.entries(ws.allocation).forEach(([roleId, allocation]) => {
                        const role = findRole(roleId);
                        if (role && shouldDisplayRole(role)) {
                            wsFTE += allocation;
                        }
                    });
                    return `<div>${ws.name}: ${wsFTE.toFixed(2)} FTE</div>`;
                }).join('')}
            </div>
        </div>
    `;
}

function renderRoleCapacityTable() {
    const roleCapacity = {};

    Object.entries(programData.roles).forEach(([category, roles]) => {
        Object.entries(roles).forEach(([roleId, role]) => {
            if (role.title && shouldDisplayRole(role)) {
                // Calculate projected FTE based on hours per week
                const totalHours = role.responsibilities.reduce((sum, r) => {
                    return sum + (typeof r === 'object' ? r.hours : 0);
                }, 0);
                const projectedFTE = totalHours > 0 ? totalHours / 40 : 0;

                roleCapacity[roleId] = {
                    title: role.title,
                    required: 0,
                    allocated: 0,
                    projectedFTE: projectedFTE,
                    totalHours: totalHours
                };
            }
        });
    });

    programData.structure.program.roles.forEach(roleId => {
        const role = findRole(roleId);
        if (role && roleCapacity[roleId]) roleCapacity[roleId].required += role.fte;
    });

    Object.values(programData.structure.projects).forEach(project => {
        project.roles.forEach(roleId => {
            const role = findRole(roleId);
            if (role && roleCapacity[roleId]) {
                roleCapacity[roleId].required += role.fte;
            }
        });

        project.workstreams.forEach(ws => {
            Object.entries(ws.allocation).forEach(([roleId, allocation]) => {
                if (roleCapacity[roleId]) {
                    roleCapacity[roleId].required += allocation;
                }
            });
        });
    });

    programData.roster.forEach(member => {
        if (member.role !== 'unassigned' && roleCapacity[member.role]) {
            roleCapacity[member.role].allocated += member.allocation / 100;
        }
    });

    return `
        <table class="capacity-table">
            <thead>
                <tr>
                    <th>Role</th>
                    <th>Planned FTE</th>
                    <th>Projected FTE (Actual)</th>
                    <th>Allocated FTE</th>
                    <th>Gap</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                ${Object.entries(roleCapacity).map(([roleId, data]) => {
                    const gap = data.required - data.allocated;
                    const status = gap === 0 ? 'filled' : gap > 0 ? 'gap' : 'over';
                    return `
                        <tr>
                            <td>${data.title}</td>
                            <td>${data.required.toFixed(2)}</td>
                            <td>${data.projectedFTE ? data.projectedFTE.toFixed(2) : '0.00'} ${data.projectedFTE > data.required * 1.2 ? '<span style="color: #ef4444; font-size: 11px;">âš ï¸ Over capacity</span>' : ''}</td>
                            <td>${data.allocated.toFixed(2)}</td>
                            <td class="${status}">${gap.toFixed(2)}</td>
                            <td><span class="status-badge ${status}">${status}</span></td>
                        </tr>
                    `;
                }).join('')}
            </tbody>
        </table>
    `;
}

// RACI Matrix
function renderRACIMatrix() {
    const matrix = document.getElementById('raciMatrix');
    const roles = getAllRoles();

    matrix.innerHTML = `
        <table class="raci-table">
            <thead>
                <tr>
                    <th>Responsibility</th>
                    ${roles.map(r => `<th class="rotate">${r.title}</th>`).join('')}
                </tr>
            </thead>
            <tbody>
                ${programData.raciMatrix.responsibilities.map(resp => `
                    <tr>
                        <td>${resp}</td>
                        ${roles.map(role => `
                            <td>
                                <select class="raci-select" data-resp="${resp}" data-role="${role.id}">
                                    <option value="">-</option>
                                    <option value="R">R</option>
                                    <option value="A">A</option>
                                    <option value="C">C</option>
                                    <option value="I">I</option>
                                </select>
                            </td>
                        `).join('')}
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;

    setDefaultRACI();
}

function getAllRoles() {
    const roles = [];
    Object.entries(programData.roles).forEach(([category, categoryRoles]) => {
        Object.entries(categoryRoles).forEach(([id, role]) => {
            if (role.title) {
                roles.push({ id, ...role });
            }
        });
    });
    return roles;
}

function setDefaultRACI() {
    const defaults = {
        "Program Strategy & Vision": { "executive-sponsor": "A", "strategic-program-director": "R" },
        "Budget & Resource Management": { "strategic-program-director": "A", "engagement-manager-snowflake": "R", "engagement-manager-arbit": "R" },
        "Technical Architecture": { "architect-snowflake": "A", "architect-arbit": "A", "lead-engineer-halo": "R" },
        "Product Roadmap": { "product-owner-snowflake": "A", "product-owner-arbit": "A", "strategic-program-director": "C" },
        "Sprint Planning & Execution": { "engagement-manager-snowflake": "A", "engagement-manager-arbit": "A", "lead-engineer-halo": "R" },
        "Quality Assurance": { "qa-engineer": "R", "lead-engineer-halo": "A", "product-owner-snowflake": "I" },
        "Stakeholder Communication": { "strategic-program-director": "A", "product-owner-snowflake": "R", "executive-sponsor": "I" },
        "Risk Management": { "strategic-program-director": "A", "engagement-manager-snowflake": "R", "executive-sponsor": "I" },
        "Vendor Management": { "engagement-manager-snowflake": "A", "strategic-program-director": "C", "lead-engineer-hakkoda": "R" },
        "Team Performance": { "strategic-program-director": "A", "lead-engineer-halo": "R", "lead-fullstack": "R" },
        "Compliance & Security": { "architect-snowflake": "A", "strategic-program-director": "C", "qa-engineer": "R" },
        "Change Management": { "strategic-program-director": "A", "product-owner-snowflake": "R", "executive-sponsor": "I" }
    };

    Object.entries(defaults).forEach(([resp, assignments]) => {
        Object.entries(assignments).forEach(([roleId, value]) => {
            const select = document.querySelector(`select[data-resp="${resp}"][data-role="${roleId}"]`);
            if (select) select.value = value;
        });
    });
}

// Roster Management
function renderRoster() {
    const rosterGrid = document.getElementById('rosterGrid');

    if (programData.roster.length === 0) {
        rosterGrid.innerHTML = `
            <div class="empty-roster">
                <p>No team members assigned yet.</p>
                <p>Click "Add Team Member" to start building your team.</p>
            </div>
        `;
    } else {
        rosterGrid.innerHTML = `
            <table class="roster-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Team</th>
                        <th>Role</th>
                        <th>Allocation</th>
                        <th>Start Date</th>
                        <th>Skills</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${programData.roster.map((member, index) => `
                        <tr>
                            <td>${member.name}</td>
                            <td>${member.team || 'TBD'}</td>
                            <td>${member.role === 'unassigned' ? 'Unassigned' : findRole(member.role).title}</td>
                            <td>${member.allocation}%</td>
                            <td>${member.startDate || 'TBD'}</td>
                            <td>${member.skills || 'N/A'}</td>
                            <td>
                                <button onclick="editMember(${index})">Assign</button>
                                <button onclick="removeMember(${index})">Remove</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }
}

// Modal Functions
function initializeModals() {
    const modals = document.querySelectorAll('.modal');
    const closeButtons = document.querySelectorAll('.modal .close');

    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            this.closest('.modal').style.display = 'none';
        });
    });

    window.addEventListener('click', function(event) {
        modals.forEach(modal => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });
}

function showRoleDetail(roleId) {
    const modal = document.getElementById('roleModal');
    const content = document.getElementById('roleModalContent');
    const role = findRole(roleId);

    if (role) {
        content.innerHTML = `
            <h2>${role.title}</h2>
            <div class="role-detail-full">
                <div class="detail-meta">
                    <span class="badge">${role.level}</span>
                    <span class="badge">${role.fte} FTE</span>
                    <span class="badge category-${role.category}">${role.category}</span>
                </div>
                <p class="description">${role.description}</p>
                <div class="detail-grid">
                    <div class="detail-column">
                        <h3>Key Responsibilities</h3>
                        <ul>${role.responsibilities.map(r => {
                            if (typeof r === 'string') return `<li>${r}</li>`;
                            return `<li>${r.task} <span style="color: #666; font-size: 12px;">(${r.hours} hrs/week)</span></li>`;
                        }).join('')}</ul>
                        ${(() => {
                            const totalHours = role.responsibilities.reduce((sum, r) => {
                                return sum + (typeof r === 'object' ? r.hours : 0);
                            }, 0);
                            if (totalHours > 40) {
                                return `<p style="margin-top: 10px; padding: 10px 14px; background: #fef3c7; border-radius: 8px; font-size: 13px; color: #92400e;">âš ï¸ Total: ${totalHours} hrs/week - Consider splitting this role</p>`;
                            }
                            return '';
                        })()}
                    </div>
                    ${role.workstreamSuccessMetrics ? `
                    <div class="detail-column">
                        <h3>Workstream Success Metrics</h3>
                        <ul>${role.workstreamSuccessMetrics.map(m => `<li>${m}</li>`).join('')}</ul>
                    </div>
                    ` : ''}
                    <div class="detail-column">
                        <h3>Success Metrics</h3>
                        <ul>${role.successMetrics.map(m => `<li>${m}</li>`).join('')}</ul>
                    </div>
                    <div class="detail-column">
                        <h3>Key Interfaces</h3>
                        <ul>${role.interfaces.map(i => `<li>${i}</li>`).join('')}</ul>
                    </div>
                </div>
            </div>
        `;
        modal.style.display = 'block';
    }
}

function addTeamMember() {
    const modal = document.getElementById('assignmentModal');
    const roleSelect = document.getElementById('memberRole');

    console.log('programData.roles:', programData.roles);
    
    roleSelect.innerHTML = '<option value="">Select a role</option>';
    
    let optionCount = 0;
    Object.entries(programData.roles).forEach(([category, roles]) => {
        console.log('Category:', category, 'Roles:', roles);
        Object.entries(roles).forEach(([roleId, role]) => {
            console.log('RoleId:', roleId, 'Role:', role);
            if (role && role.title) {
                optionCount++;
                const option = document.createElement('option');
                option.value = roleId;
                option.textContent = `${role.title} (${category})`;
                roleSelect.appendChild(option);
                console.log('Added option:', option.textContent);
            }
        });
    });
    
    console.log('Total options added:', optionCount);
    console.log('roleSelect.options.length:', roleSelect.options.length);

    modal.style.display = 'block';
}

document.getElementById('assignmentForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const member = {
        name: document.getElementById('memberName').value,
        team: document.getElementById('memberTeam').value,
        role: document.getElementById('memberRole').value,
        allocation: parseInt(document.getElementById('memberAllocation').value),
        startDate: document.getElementById('memberStartDate').value,
        skills: ''
    };

    programData.roster.push(member);
    renderRoster();
    renderCapacityPlanning();
    renderOrgChart(); // Update org chart when team member is assigned

    document.getElementById('assignmentModal').style.display = 'none';
    this.reset();
});

// Utility Functions
function expandAll() {
    document.querySelectorAll('.workstreams-container').forEach(container => {
        container.style.display = 'block';
    });
}

function collapseAll() {
    document.querySelectorAll('.workstreams-container').forEach(container => {
        container.style.display = 'none';
    });
}

function toggleWorkstreams(projectId) {
    const container = document.getElementById(`ws-${projectId}`);
    container.style.display = container.style.display === 'none' ? 'block' : 'none';
}

function exportChart() {
    const data = {
        program: programData,
        roster: programData.roster,
        timestamp: new Date().toISOString()
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'halo-program-structure.json';
    a.click();
}

function exportRACI() {
    const rows = [['Responsibility', ...getAllRoles().map(r => r.title)]];

    programData.raciMatrix.responsibilities.forEach(resp => {
        const row = [resp];
        getAllRoles().forEach(role => {
            const select = document.querySelector(`select[data-resp="${resp}"][data-role="${role.id}"]`);
            row.push(select ? select.value : '');
        });
        rows.push(row);
    });

    const csv = rows.map(row => row.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'raci-matrix.csv';
    a.click();
}

function closeAssignmentModal() {
    document.getElementById('assignmentModal').style.display = 'none';
}

function editMember(index) {
    const member = programData.roster[index];
    document.getElementById('memberName').value = member.name;
    document.getElementById('memberRole').value = member.role;
    document.getElementById('memberAllocation').value = member.allocation;
    document.getElementById('memberStartDate').value = member.startDate;

    programData.roster.splice(index, 1);
    document.getElementById('assignmentModal').style.display = 'block';
}

function removeMember(index) {
    if (confirm('Are you sure you want to remove this team member?')) {
        programData.roster.splice(index, 1);
        renderRoster();
        renderCapacityPlanning();
    }
}

function importRoster() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = event => {
            try {
                const data = JSON.parse(event.target.result);
                if (data.roster) {
                    programData.roster = data.roster;
                    renderRoster();
                    renderCapacityPlanning();
                    alert('Roster imported successfully!');
                }
            } catch (err) {
                alert('Error importing roster: ' + err.message);
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

function exportRoster() {
    const blob = new Blob([JSON.stringify(programData.roster, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'team-roster.json';
    a.click();
}

// Timing filter functions
function shouldDisplayRole(role) {
    const roleTiming = role.timing || 'now';
    if (currentTimingFilter === 'now') {
        return roleTiming === 'now';
    } else if (currentTimingFilter === 'next') {
        return roleTiming === 'now' || roleTiming === 'next';
    } else if (currentTimingFilter === 'later') {
        return true; // Show all roles
    }
    return false;
}

function setTimingFilter(timing) {
    currentTimingFilter = timing;

    // Update button states
    document.querySelectorAll('.timing-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.timing === timing) {
            btn.classList.add('active');
        }
    });

    // Update legend visibility
    const phaseLegend = document.getElementById('phaseLegend');
    const laterLegend = document.getElementById('laterLegend');

    if (timing === 'next') {
        phaseLegend.style.display = 'flex';
        laterLegend.style.display = 'none';
    } else if (timing === 'later') {
        phaseLegend.style.display = 'flex';
        laterLegend.style.display = 'flex';
    } else {
        phaseLegend.style.display = 'none';
        laterLegend.style.display = 'none';
    }

    // Re-render everything with new filter
    renderOrgChart();
    renderCapacityPlanning();
}

function countResources(timing) {
    let haloCount = 0;
    let hakkodaCount = 0;

    // Define exactly which roles belong to which organization based on roleId
    const haloRoles = [
        'halo-executive-sponsor',
        'halo-enterprise-architect',
        'lead-engineer-halo',
        'halo-email-ba',
        'halo-bi-developer',
        'halo-pipeline-ba',
        'devops-halo',
        'halo-analytics-ba',
        'halo-revenue-ba',
        'halo-product-owner-snowflake',
        'halo-product-owner-arbit'
    ];

    const hakkodaRoles = [
        'executive-sponsor',
        'strategic-program-director',
        'architect-snowflake',
        'architect-arbit',
        'product-owner-snowflake',
        'product-owner-arbit',
        'engagement-manager-snowflake',
        'engagement-manager-arbit',
        'ai-director',
        'hakkoda-qa-claims-engineer',
        'hakkoda-qa-email-engineer',
        'hakkoda-email-engineer',
        'hakkoda-lead-claims-engineer',
        'hakkoda-claims-engineer',
        'hakkoda-lead-email-engineer',
        'hakkoda-lead-revenue-engineer',
        'hakkoda-revenue-engineer',
        'hakkoda-revenue-engineer-2',
        'hakkoda-lead-analytics-engineer',
        'hakkoda-analytics-engineer',
        'hakkoda-customer-pipeline-em',
        'lead-fullstack',
        'fullstack-engineer',
        'uiux-ba',
        'backend-lead',
        'backend-engineer',
        'ai-engineer',
        'hakkoda-fullstack-2',
        'hakkoda-fullstack-3',
        'hakkoda-fullstack-4'
    ];

    // Helper function to check if role should be displayed
    const shouldCountRole = (role, timing) => {
        const roleTiming = role.timing || 'now';
        if (timing === 'now') {
            return roleTiming === 'now';
        } else if (timing === 'next') {
            return roleTiming === 'now' || roleTiming === 'next';
        } else if (timing === 'later') {
            return true;
        }
        return false;
    };

    // Count each visible box as one person
    // Track which roles we've counted and their max allocation
    const roleBoxCounts = new Map();

    // Count program roles
    programData.structure.program.roles.forEach(roleId => {
        const role = findRole(roleId);
        if (role && shouldCountRole(role, timing)) {
            roleBoxCounts.set(roleId, 1);
        }
    });

    // Count project roles
    Object.values(programData.structure.projects).forEach(project => {
        project.roles.forEach(roleId => {
            const role = findRole(roleId);
            if (role && shouldCountRole(role, timing)) {
                if (!roleBoxCounts.has(roleId)) {
                    roleBoxCounts.set(roleId, 1);
                }
            }
        });

        // Count workstream roles - each box counts
        project.workstreams.forEach(ws => {
            ws.roles.forEach(roleId => {
                const role = findRole(roleId);
                if (role && shouldCountRole(role, timing)) {
                    const allocation = ws.allocation[roleId] || 1.0;
                    // For roles with >1 FTE, count multiple boxes
                    const boxCount = allocation > 1.0 ? Math.ceil(allocation) : 1;

                    // Update to max count seen for this role
                    const currentCount = roleBoxCounts.get(roleId) || 0;
                    roleBoxCounts.set(roleId, Math.max(currentCount, boxCount));
                }
            });
        });
    });

    // Now count by organization based on explicit mapping
    roleBoxCounts.forEach((count, roleId) => {
        if (haloRoles.includes(roleId)) {
            haloCount += count;
        } else if (hakkodaRoles.includes(roleId)) {
            hakkodaCount += count;
        }
    });

    return { halo: haloCount, hakkoda: hakkodaCount, total: haloCount + hakkodaCount };
}

function updateResourceCounts() {
    const currentCounts = countResources(currentTimingFilter);
    const nowCounts = countResources('now');

    // Update Halo count
    const haloElement = document.getElementById('haloCount');
    const haloDiff = currentCounts.halo - nowCounts.halo;
    let haloText = `${currentCounts.halo}`;
    if (currentTimingFilter !== 'now' && haloDiff > 0) {
        haloText += ` <span class="count-change change-positive">+${haloDiff}</span>`;
    }
    haloElement.innerHTML = haloText;

    // Update Hakkoda count
    const hakkodaElement = document.getElementById('hakkodaCount');
    const hakkodaDiff = currentCounts.hakkoda - nowCounts.hakkoda;
    let hakkodaText = `${currentCounts.hakkoda}`;
    if (currentTimingFilter !== 'now' && hakkodaDiff > 0) {
        hakkodaText += ` <span class="count-change change-positive">+${hakkodaDiff}</span>`;
    }
    hakkodaElement.innerHTML = hakkodaText;

    // Update total
    const totalElement = document.getElementById('totalCount');
    const totalDiff = currentCounts.total - nowCounts.total;
    let totalText = `Total: ${currentCounts.total}`;
    if (currentTimingFilter !== 'now' && totalDiff > 0) {
        totalText += ` <span class="count-change change-positive">+${totalDiff}</span>`;
    }
    totalElement.innerHTML = totalText;
}

// Configuration Page Functions
function loadConfigData() {
    // Load phase dates if saved in localStorage
    const savedPhases = localStorage.getItem('phaseConfig');
    if (savedPhases) {
        phaseConfig = JSON.parse(savedPhases);
        // Update the input fields
        const nowStart = document.getElementById('now-start');
        const nowEnd = document.getElementById('now-end');
        const nextStart = document.getElementById('next-start');
        const nextEnd = document.getElementById('next-end');
        const laterStart = document.getElementById('later-start');
        const laterEnd = document.getElementById('later-end');

        if (nowStart) nowStart.value = phaseConfig.now.start;
        if (nowEnd) nowEnd.value = phaseConfig.now.end;
        if (nextStart) nextStart.value = phaseConfig.next.start;
        if (nextEnd) nextEnd.value = phaseConfig.next.end;
        if (laterStart) laterStart.value = phaseConfig.later.start;
        if (laterEnd) laterEnd.value = phaseConfig.later.end;
    }

    // Load role start dates if saved
    const savedRoleDates = localStorage.getItem('roleStartDates');
    if (savedRoleDates) {
        roleStartDates = JSON.parse(savedRoleDates);
    }
}

function savePhaseDates() {
    phaseConfig = {
        now: {
            start: document.getElementById('now-start').value,
            end: document.getElementById('now-end').value
        },
        next: {
            start: document.getElementById('next-start').value,
            end: document.getElementById('next-end').value
        },
        later: {
            start: document.getElementById('later-start').value,
            end: document.getElementById('later-end').value
        }
    };

    localStorage.setItem('phaseConfig', JSON.stringify(phaseConfig));
    alert('Phase dates saved successfully!');
}

function renderConfigPage() {
    const grid = document.getElementById('roleTimingGrid');
    if (!grid) return;

    grid.innerHTML = '';

    // Get all roles from all categories
    const allRoles = [];
    Object.entries(programData.roles).forEach(([category, roles]) => {
        Object.entries(roles).forEach(([roleId, role]) => {
            allRoles.push({
                id: roleId,
                category: category,
                ...role
            });
        });
    });

    // Sort by category and title
    allRoles.sort((a, b) => {
        if (a.category !== b.category) {
            return a.category.localeCompare(b.category);
        }
        return a.title.localeCompare(b.title);
    });

    // Create role items
    allRoles.forEach(role => {
        const item = document.createElement('div');
        item.className = 'role-timing-item';
        item.dataset.roleId = role.id;
        item.dataset.category = role.category;
        item.dataset.timing = role.timing || 'now';
        item.dataset.title = role.title.toLowerCase();

        const startDate = roleStartDates[role.id] || getPhaseStartDate(role.timing || 'now');

        item.innerHTML = `
            <div class="role-info">
                <div class="role-title">${role.title}</div>
                <div class="role-category">${role.category}</div>
            </div>
            <div class="timing-selector">
                <div class="timing-radio">
                    <input type="radio" name="timing-${role.id}" id="now-${role.id}" value="now" ${role.timing === 'now' || !role.timing ? 'checked' : ''}>
                    <label for="now-${role.id}">Now</label>
                </div>
                <div class="timing-radio">
                    <input type="radio" name="timing-${role.id}" id="next-${role.id}" value="next" ${role.timing === 'next' ? 'checked' : ''}>
                    <label for="next-${role.id}">Next</label>
                </div>
                <div class="timing-radio">
                    <input type="radio" name="timing-${role.id}" id="later-${role.id}" value="later" ${role.timing === 'later' ? 'checked' : ''}>
                    <label for="later-${role.id}">Later</label>
                </div>
            </div>
            <div class="role-start-date">
                <label>Start:</label>
                <input type="date" id="start-${role.id}" value="${startDate}">
            </div>
            <div style="text-align: right; display: flex; gap: 8px; justify-content: flex-end;">
                <button class="edit-role-btn" onclick="openEditRoleModal('${role.id}', '${role.category}')">Edit</button>
                <button class="btn-secondary" onclick="removeRole('${role.id}')" style="padding: 6px 12px; font-size: 13px;">Remove</button>
            </div>
        `;

        grid.appendChild(item);
    });
}

function getPhaseStartDate(timing) {
    return phaseConfig[timing]?.start || '';
}

function filterConfigRoles() {
    const searchTerm = document.getElementById('roleSearch').value.toLowerCase();
    const phaseFilter = document.getElementById('phaseFilter').value;

    const items = document.querySelectorAll('.role-timing-item');
    items.forEach(item => {
        const title = item.dataset.title;
        const timing = item.querySelector('input[type="radio"]:checked')?.value || 'now';

        const matchesSearch = !searchTerm || title.includes(searchTerm);
        const matchesPhase = phaseFilter === 'all' || timing === phaseFilter;

        if (matchesSearch && matchesPhase) {
            item.classList.remove('hidden');
        } else {
            item.classList.add('hidden');
        }
    });
}

function saveRoleTimings() {
    const items = document.querySelectorAll('.role-timing-item');

    items.forEach(item => {
        const roleId = item.dataset.roleId;
        const category = item.dataset.category;
        const newTiming = item.querySelector('input[type="radio"]:checked').value;
        const startDate = item.querySelector(`#start-${roleId}`).value;

        // Update the role timing in the data structure
        if (programData.roles[category] && programData.roles[category][roleId]) {
            programData.roles[category][roleId].timing = newTiming;
        }

        // Save the start date
        if (startDate) {
            roleStartDates[roleId] = startDate;
        }
    });

    // Save to localStorage
    localStorage.setItem('roleStartDates', JSON.stringify(roleStartDates));

    // Refresh the org chart to reflect changes
    renderOrgChart();
    renderCapacityPlanning();
    updateResourceCounts();

    alert('Role timings saved successfully!');
}

function removeRole(roleId) {
    if (!confirm('Are you sure you want to remove this role from the organization?')) {
        return;
    }

    // Find and remove the role from the data structure
    Object.entries(programData.roles).forEach(([category, roles]) => {
        if (roles[roleId]) {
            delete roles[roleId];
        }
    });

    // Remove from projects if assigned
    Object.values(programData.projects).forEach(project => {
        Object.values(project.workstreams).forEach(workstream => {
            const index = workstream.roles.indexOf(roleId);
            if (index > -1) {
                workstream.roles.splice(index, 1);
            }
        });
    });

    // Re-render the configuration page and org chart
    renderConfigPage();
    renderOrgChart();
    renderCapacityPlanning();
    updateResourceCounts();

    alert('Role removed successfully!');
}

// Workstream Definitions Functions
function renderWorkstreamDefinitions() {
    const grid = document.getElementById('workstreamsGrid');
    if (!grid) return;

    grid.innerHTML = '';

    // Check if workstreamDefinitions exists (it's inside structure)
    if (!programData || !programData.structure || !programData.structure.workstreamDefinitions) {
        console.log('ProgramData:', programData);
        console.error('Workstream definitions not found');
        return;
    }

    // Render workstream definitions
    Object.entries(programData.structure.workstreamDefinitions).forEach(([wsId, wsData]) => {
        const card = document.createElement('div');
        card.className = 'workstream-card';

        const phasesHtml = Object.entries(wsData.deliverables).map(([phase, items]) => {
            const itemsHtml = items.map(item => `<li>${item}</li>`).join('');
            return `
                <div class="phase-section ${phase}">
                    <div class="phase-label">${phase.charAt(0).toUpperCase() + phase.slice(1)} Phase</div>
                    <ul class="deliverables-list">
                        ${itemsHtml}
                    </ul>
                </div>
            `;
        }).join('');

        const goalsHtml = wsData.goals.map(goal => `<li>${goal}</li>`).join('');

        card.innerHTML = `
            <div class="workstream-header">
                <div class="workstream-title">
                    ${wsData.name}
                    <span class="project-badge">${wsData.project}</span>
                </div>
                <div class="mission-statement">
                    "${wsData.mission}"
                </div>
            </div>
            <div class="workstream-content">
                <div class="workstream-section">
                    <div class="section-title">Purpose</div>
                    <div class="section-content">${wsData.purpose}</div>
                </div>
                <div class="workstream-section">
                    <div class="section-title">Key Goals</div>
                    <ul class="goals-list">
                        ${goalsHtml}
                    </ul>
                </div>
                <div class="workstream-section">
                    <div class="section-title">Deliverables by Phase</div>
                    <div class="phase-deliverables">
                        ${phasesHtml}
                    </div>
                </div>
            </div>
        `;

        grid.appendChild(card);
    });
}

function switchDefinitionType(type) {
    // Update button states
    document.querySelectorAll('.def-type-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === type);
    });

    // Show/hide content
    const workstreamDef = document.getElementById('workstreamDefinitions');
    const roleDef = document.getElementById('roleDefinitions');

    if (type === 'workstreams') {
        workstreamDef.style.display = 'block';
        roleDef.style.display = 'none';

        // Render workstream definitions if not already rendered
        const grid = document.getElementById('workstreamsGrid');
        if (grid && grid.children.length === 0) {
            renderWorkstreamDefinitions();
        }
    } else {
        workstreamDef.style.display = 'none';
        roleDef.style.display = 'block';
    }
}

// Role Add/Edit Modal Functions
function openAddRoleModal() {
    const modal = document.getElementById('roleEditModal');
    const modalTitle = document.getElementById('roleModalTitle');
    const form = document.getElementById('roleEditForm');

    // Reset form
    form.reset();
    modalTitle.textContent = 'Add New Role';
    document.getElementById('roleId').value = '';
    document.getElementById('roleFTE').value = '1.0';
    document.getElementById('roleTiming').value = 'now';

    // Clear responsibilities and metrics lists
    document.getElementById('responsibilitiesList').innerHTML = '';
    document.getElementById('metricsList').innerHTML = '';

    // Add default responsibility and metric
    addResponsibility();
    addMetric();

    modal.style.display = 'block';
}

function openEditRoleModal(roleId, category) {
    const modal = document.getElementById('roleEditModal');
    const modalTitle = document.getElementById('roleModalTitle');
    const role = programData.roles[category][roleId];

    if (!role) {
        alert('Role not found');
        return;
    }

    modalTitle.textContent = 'Edit Role: ' + role.title;

    // Populate form fields
    document.getElementById('roleId').value = roleId;
    document.getElementById('roleCategory').value = category;
    document.getElementById('roleTitle').value = role.title;
    document.getElementById('roleLevel').value = role.level || 'Senior';
    document.getElementById('roleFTE').value = role.fte || 1.0;
    document.getElementById('roleCategorySelect').value = category;
    document.getElementById('roleTiming').value = role.timing || 'now';
    document.getElementById('roleStartDate').value = roleStartDates[roleId] || '';
    document.getElementById('roleDescription').value = role.description || '';

    // Populate responsibilities
    const respList = document.getElementById('responsibilitiesList');
    respList.innerHTML = '';
    if (role.responsibilities && role.responsibilities.length > 0) {
        role.responsibilities.forEach(resp => {
            if (typeof resp === 'object' && resp.task) {
                addResponsibility(resp.task, resp.hours);
            } else if (typeof resp === 'string') {
                addResponsibility(resp, 0);
            }
        });
    } else {
        addResponsibility();
    }

    // Populate success metrics
    const metricsList = document.getElementById('metricsList');
    metricsList.innerHTML = '';
    if (role.successMetrics && role.successMetrics.length > 0) {
        role.successMetrics.forEach(metric => {
            addMetric(metric);
        });
    } else {
        addMetric();
    }

    modal.style.display = 'block';
}

function closeRoleModal() {
    document.getElementById('roleEditModal').style.display = 'none';
}

function addResponsibility(task = '', hours = '') {
    const list = document.getElementById('responsibilitiesList');
    const item = document.createElement('div');
    item.className = 'responsibility-item';
    item.innerHTML = `
        <input type="text" placeholder="Task description" value="${task}" class="task-input">
        <input type="number" placeholder="Hours/week" value="${hours}" min="0" max="40" step="0.5" class="hours-input">
        <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()">Ã—</button>
    `;
    list.appendChild(item);
}

function addMetric(metric = '') {
    const list = document.getElementById('metricsList');
    const item = document.createElement('div');
    item.className = 'metric-item';
    item.innerHTML = `
        <input type="text" placeholder="Success metric" value="${metric}">
        <button type="button" class="remove-item-btn" onclick="this.parentElement.remove()">Ã—</button>
    `;
    list.appendChild(item);
}


function saveRoleFromModal() {
    const roleId = document.getElementById('roleId').value || generateRoleId();
    const oldCategory = document.getElementById('roleCategory').value;
    const newCategory = document.getElementById('roleCategorySelect').value;

    // Collect responsibilities
    const responsibilities = [];
    document.querySelectorAll('.responsibility-item').forEach(item => {
        const task = item.querySelector('.task-input').value.trim();
        const hours = parseFloat(item.querySelector('.hours-input').value) || 0;
        if (task) {
            responsibilities.push({ task, hours });
        }
    });

    // Collect metrics
    const successMetrics = [];
    document.querySelectorAll('.metric-item input[type="text"]').forEach(input => {
        const metric = input.value.trim();
        if (metric) {
            successMetrics.push(metric);
        }
    });

    // Create role object
    const roleData = {
        title: document.getElementById('roleTitle').value,
        category: newCategory,
        level: document.getElementById('roleLevel').value,
        fte: parseFloat(document.getElementById('roleFTE').value),
        timing: document.getElementById('roleTiming').value,
        description: document.getElementById('roleDescription').value,
        responsibilities: responsibilities,
        successMetrics: successMetrics,
        interfaces: [] // You can expand this later
    };

    // If category changed, remove from old category
    if (oldCategory && oldCategory !== newCategory && programData.roles[oldCategory]) {
        delete programData.roles[oldCategory][roleId];
    }

    // Ensure category exists
    if (!programData.roles[newCategory]) {
        programData.roles[newCategory] = {};
    }

    // Save role
    programData.roles[newCategory][roleId] = roleData;

    // Save start date if provided
    const startDate = document.getElementById('roleStartDate').value;
    if (startDate) {
        roleStartDates[roleId] = startDate;
    }

    // Save to localStorage
    localStorage.setItem('roleStartDates', JSON.stringify(roleStartDates));

    // Close modal and refresh displays
    closeRoleModal();
    renderConfigPage();
    renderOrgChart();
    renderCapacityPlanning();
    renderRoleDefinitions();
    updateResourceCounts();

    alert('Role saved successfully!');
}

function generateRoleId() {
    // Generate a unique role ID
    const timestamp = Date.now();
    const random = Math.floor(Math.random() * 1000);
    return `role-${timestamp}-${random}`;
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('roleEditModal');
    if (event.target === modal) {
        closeRoleModal();
    }
}
    </script>
</body>
</html>